=========================================================================================================
                                    General
=========================================================================================================
Hub              ## device that receives information at one port and duplicates to other
Unmanaged switch ## device that knows topology of the network and sends only to requested devices, however
                    you cannot configure it
Managed switch   ## allows you to configure/program it to do certain things?
Virtual switch   ## program that allows one virtual machine to communicate with another
---------------------------------------------------------------------------------------------------------
internet - global network, connects many networks using the tcp/ip stack
           The arpanet was origin of internet
intranet - private tcp/ip network => accessible for people from within one 
           organization
extranet - intranet that can be accessed by trusted organizations
---------------------------------------------------------------------------------------------------------
                               Binding vs Bonding
---------------------------------------------------------------------------------------------------------
TODO

binding - assigning ip for nic
bonding - using >1 nic behind 1 ip
to assign >1 ip to interface from /etc/network
auto #intf_name:#sequence_number_of_ip
then ifup #name:#number

=========================================================================================================
                                Modem VS Router
=========================================================================================================
Router => device that knows how to send packets to another nrtwork but it understands only discreat signals
Modem => de/modulates analog signals
TODO

=========================================================================================================
                                    Ethernet
=========================================================================================================
Max frame size => 1518 bytes (including 4byte CRC and 14byte header)
Inter Frame Gap => 12 bytes send between frames to avoid collisions
---------------------------------------------------------------------------------------------------------
                      Ethernet Technology Characteristics
---------------------------------------------------------------------------------------------------------
The major reason for the success of Ethernet in industry was the adoption of the Ethernet standard
(IEEE 802.3), allowing for interoperability between different vendor’s products (Carrier Sense Multiple
Access with Collision Detection CSMA/CD, Access Method and Physical Layer Specifications). This
specification allowed many different vendors to produce network interfaces and media that supported
Ethernet.

Ethernet is a very flexible system because interfaces operating at different transmission rates can be
connected to the same LAN.

There are three elements in Ethernet:
1. Physical media segments, which are used to interconnect systems
2. The Media Access Control (MAC) rules that implement access to Ethernet channels
3. A frame that organizes data to be transmitted in a standard way

When transmitting data, a station must wait for the channel to be free of data before sending a packet
formatted as a frame. The mechanism for preventing packet collision is the Carrier Sense Multiple Access
with Collision Detection (CSMA/CD) method specified by the IEEE standard. Prior to data being transmitted,
a station must enter Carrier Sense (CS) mode. If no data is detected on the channel, all stations have an
equal opportunity to transmit a frame, a condition known as Multiple Access (MA). If two or more stations
begin transmitting frames and detect that they are transmitting at the same time, a state known as Collision
Detection (CD), then the stations halt transmission, enter the CS mode and wait for the next MA. When a
collision occurs, the frames must be re-sent by their respective parties, delay between retransmission
is randomized for each network interface.

? How does station know that some one else starte sending data at the same moment?

Ethernet has a logical topology, or tree-like structure, that is distinct from the set of physical interfaces
that are interconnected using networking cable. One of the implications of this tree-like structure is that
individual branches can be segmented in order to logically isolate structural groups. This structure also
allows a large number of unrelated networks to be connected to each other 
Individual network branches can be linked together by using a repeater of some kind, such as a hub or a switch.
http://etutorials.org/Misc/solaris+exam+guide/Part+III+Solaris+9+Operating+Environment+Objectives/Chapter+33+Ethernet/Ethernet+Characteristics/
---------------------------------------------------------------------------------------------------------
                             Ethernet frame format
---------------------------------------------------------------------------------------------------------
Through ethernet development there was many additions to ethernet frame structure
The first type of ethernet frame was ethernet II
Preamble - 8bytes, identifies start of ethernet frame
DA       - 6bytes, destination mac address, can unicast,multicast or brodcast
SA       - 6bytes, source mac address, unicast only
E-Type   - 2bytes, l3 protocol identifier IP4,IP6
PAYLOAD  - 46 through 1500 bytes
FCS      - 4bytes, CRC frame check sequence

Ethernet 802.3/802.2 (802.3 with LLC header)
E-Type was replaced with Length wich identified count of bytes after this field
SSAP(Source service access point) and DSAP (Destination service access point) byte fields were added
to identify l3 protocol used.
Control byte field was added

Next evoultion will be 802.3 with SNAP header

https://habr.com/ru/post/227729/
---------------------------------------------------------------------------------------------------------
                               10Base-T Standart
---------------------------------------------------------------------------------------------------------
10Base-T is the Ethernet wiring standard for 10 Mbps (megabits per second) for a maximum distance of
approximately 100 meters per segment over unshielded twisted pair cables terminated with RJ-45 connectors.
The name 10Base-T is derived from several aspects of the physical medium. The 10 refers to the transmission
speed of 10 Mbps. The base is short for baseband, which means that only one Ethernet signal is present on the
send and/or receive pair (i.e., there is no multiplexing as with broadband transmissions). The T comes
from twisted pair.  10Base-T does not specify the exact type of wiring to be used. 
10Base-T was the first vendor-independent standard implementation of Ethernet on twisted pair wiring
http://www.linfo.org/10baset.html
---------------------------------------------------------------------------------------------------------
                               10Base F standart
---------------------------------------------------------------------------------------------------------
10BASE-F is a generic term for the family of 10 Mbit/s Ethernet standards using fiber optic cable. In
10BASE-F, the 10 represents a maximum throughput of 10 Mbit/s, BASE indicates its use of baseband
transmission, and F indicates that it relies on medium of fiber-optic cable. One strand is used for data
transmission while the other is used for reception, making 10BASE-F a full-duplex technology. There a three
different variants of 10BASE-F: 10BASE-FL, 10BASE-FB and 10BASE-FP. Of these only 10BASE-FL experienced
widespread use.
---------------------------------------------------------------------------------------------------------
                                 Fast Ethernet
---------------------------------------------------------------------------------------------------------
Fast Ethernet is an extension of the 10 megabit Ethernet standard. It runs on twisted pair or optical
fiber cable in a star wired bus topology.Of the Fast Ethernet physical layers, 100BASE-TX is by far the
most common. The "100" in the media type designation refers to the transmission speed of 100 Mbit/s, while
the "BASE" refers to baseband signalling. The letter following the dash ("T" or "F") refers to the physical
medium that carries the signal (twisted pair or fiber, respectively), while the last character
("X", "4", etc.) refers to the line code method used.

---------------------------------------------------------------------------------------------------------
                                  Ports + leds
---------------------------------------------------------------------------------------------------------
Switch ports are layer 2 interfaces which are used to carry layer 2 traffic. A single switch port can
carry single VLAN traffic whether it is an access port or trunk port.

Ports can be classified by its usage :
1. Access port. 

Ethernet ports usually have 2 leds, one represents the connection state (fixed light) and the other
represents activity. Usually the connection state is green or yellow/orange where green means higher
speed and yellow/orange means lower speed. (Available speeds are 10/100/1000 megabits/sec). Speed is
negotiated at connection, then is fixed. The activity led is usually green and blinks when data is sensed
thru the port 

On cheap switches there is usually a single green led per port indicating connection, which blinks when
data is seen passing. Advanced switches can have different meanings for lights depending on user action
or configuration.

https://www.quora.com/What-do-the-different-colors-of-lights-in-an-Ethernet-port-mean
=========================================================================================================
            Token Ring and FDDI (Fiber Distributed Datra Intreface)
=========================================================================================================
Token Ring => L1 protocol created before ethernet and used in ring topology. Token was going through
circle and device having it could send message to another.

FDDI => a set of standars for transmitting data over fiber-optic cable over a span of up to 124 miles
It is usually used as backbone in WAN

TODO
=========================================================================================================
                                  Broadcasting
=========================================================================================================
Broadcast frames are forwarded out all switch ports except the original ingress port. This ensures that
all devices in a broadcast domain are able to receive the frame. If there is more than one path through
which the frame can be forwarded, an endless loop can result. When a loop occurs, it is possible for the
MAC address table on a switch to constantly change with the updates from the broadcast frames, which
results in MAC database instability.

Ethernet Multicast address => 01:00:00:00:00:00
Ethernet Broadcast address => ff:ff:ff:ff:ff:ff

http://www.ciscopress.com/articles/article.asp?p=2832407&seqNum=4
=========================================================================================================
                                      ARP
=========================================================================================================
Address Resolution Protocol => protocol used by IPv4 to map IP addresses to hardware MAC address.
Ethernet network uses two hardware addresses which identify source and destination of each frame.
Each computer NIC (network interface card) is allocated a globally unique 6 byte link address when the
factory manufactures the card. This address is called MAC on Ethernet layer and is used as source address
for localy generated frame and as destination for received frame.
The destination address all 1`s is refred as broadcast packet.

ARP message types
1. Request. Requst send over ethernet to every host on the shraed link-layer segment,
   This is called link-layer broadcast
   User respones to requester only
2. Probe. Arp asks whether ip is used
3. Reply. Owner of ip replying
4. Announcment. You assign ip to urself

To send packet to some host by its IP we need to fill L2 frame as well, therefore we need to
know mac address of the device. This is doen with arp request which is sent over broadcast
and looks like `who is X.X.X.X tell Y.Y.Y.Y`. It is required that only owner of this IP responds
and all other sillently drop the frame. The target forms arp reply of form `X.X.X.X is hh:hh:hh:hh:hh:hh`
and send it as unicast response. 

ARP probe and announcment are part of DAD (Duplicate Address Detection)
---------------------------------------------------------------------------------------------------------
         FIB (Forwarding Information Base) / FDB (Forwarding Data Base)
---------------------------------------------------------------------------------------------------------
FDB is used on Layer 2 (switching/bridging) to associate MAC addresses that have been learned and which
ports that MAC address was learned on. When a Ethernet frame arrives at a Layer 2 device, the Layer 2
device will inspect the destination MAC address of the frame and look to its FDB table for information
on where to send that specific Ethernet frame. If the FDB table doesn’t have any information on that
specific MAC address it will flood the Ethernet frame out to all ports in the broadcast domain.

It is implemented in terms of CAM (Content-addressable memory) which efficently associates packet 
(it`s mac?) with port.

https://blog.michaelfmcnamara.com/2008/02/what-are-the-arp-and-fdb-tables/
---------------------------------------------------------------------------------------------------------

https://erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html
https://www.practicalnetworking.net/series/arp/arp-probe-arp-announcement/
=========================================================================================================
                                    Switches
=========================================================================================================
Network switch => comupter networking device that connects devices on a computer network by using packet
switching to receive, process, and forward data to the destination device. It is a multiport network
bridge that uses hardware addresess to process and forward data at L2. There are switches that knows how
to work with IP, such switches are named multilayer switches.

Switch stores in memory table with physical port and MAC address pairs. Switch then knows which port to
use to forward the frame. Table is filled during MAC learning process, when a frame first arrives at the
switchport, the switch checks the source MAC address within the frame and stores it next to the port number
on which it was received. If destination MAC is not known yet, then frame is duplicated on each port (except
one from which it was received). Devices not interested in frame will drop it. On response, destination
address is already known, therefore frame is sent over one interface only.

If destination MAC is "FF:FF:FF:FF:FF:FF", then frame is broadcasted for each port. It is used for ARP
https://www.grandmetric.com/2018/03/08/how-does-switch-work-2/

=========================================================================================================
                               Bridging (L2,mac)
=========================================================================================================
Ethernet bridging => way to connect network segments in a protocol independent way to from a larger network.
Packets are forwarded based on Ethernet address ranther than IP address, therefore all protocols can go
transparently through a bridge.

First think to keep in mind is that we are talking abothe the Ethernet layer here.  A packet destined for
the local computer according to the bridge (which works on the Ethernet layer) isn`t necessarily destined
for the local computer according to the IP layer. That`s how routing works (MAC destination is the router,
IP destination is the actual box you want to communicate with).

Note that bridge itself can gen an IP address and may work as a standart Ethernet device. The host can
communicate via this address with other guests to the bridge.

Bridge virtual file system can be found under
/sys/devices/virtual/net/<br_name>

https://en.wikibooks.org/wiki/Switches,_Routers,_Bridges_and_LANs/Bridges
https://linux-blog.anracom.com/tag/linux-bridge-linking/
---------------------------------------------------------------------------------------------------------
                         General frame traversal scheme
---------------------------------------------------------------------------------------------------------

                        Routing ============================\
                          ||                               ||
                          ||                               ||
Physical Interface ==> Processing ==> Bridging ==>  Physical Interface
       ||                                                  ||
       ||                                                  ||
 Ethernet Frame                                      Ethernet Frame

ebtables program is a filtering layer for a bridging firewall, it also allows iptables rules to function
in bridging mode, giving you both IP and MAC level filters for your firewall


                                                    /=====> Local Process ====> Routing Decision
                                                    ||                                ||
                                              ================                 ================
                                              |   Firewall   |                 |   Firewall   |
                                              |    INPUT     |                 |    OUTPUT    |
                                              ================                 ================
                                                    ||                                ||
                                                    ||                                ||
  ================                            /=============\                  ================
  |   Routing    |                            |    FILTER   |                  |   Firewall   |
  ================                            |    INPUT    |                  |  POSTROUTING |
        ||                                    \=============/                  ================
        ||                                           ||                               ||
  /=============\       /=============\              ||                               ||
  |    BROUTE   | ====\ |     NAT     |  ===\     Bridging                     ================
  |   BROUTING  | ====/ |  PREROUTING |  ===/     decision                     |   Bridge     |
  \=============/       |   Firewall  |              ||                        |   OUTPUT     |
        ||              |  PREROUTING |              ||                        |  POSTROUTING |
        ||              \=============/       /=============\                  ================
      INPUT                                   |   FILTER    |                         ||
                                              |   FORWARD   |                         ||
                                              |   Firewall  |                         ||
                                              |   FORWARD   |                         ||
                                              \=============/                         ||
                                                     ||                               ||
                                                     ||                               ||
                                              /=============\                         ||
                                              |     NAT     |                         ||
                                              | POSTROUTING |                         ||
                                              |   Firewall  |                         ||
                                              | POSTROUTING |                         ||
                                              \=============/                         ||
                                                    ||                                ||
                                                    \============ OUTPUT===============/

=========================================================================================================
                            Ebtables rules && tables
=========================================================================================================
The firewall component of the bridging firewall is achieved using ebtables.

---------------------------------------------------------------------------------------------------------
                                 Brotute table
---------------------------------------------------------------------------------------------------------
When NIC receives a frame, it will go through BROUTING chain where you can choose whether to route
or bridge frames, enabling you to make brouter.
A brouter is a device that bridges some frames/packets and routes other frames/packets based on
configuration infomation.
The default decision for BROUTING chain is bridging
---------------------------------------------------------------------------------------------------------
                                   NAT table
---------------------------------------------------------------------------------------------------------
PREROUTING - will be passed after BROUTING, decides whether it is for local process or should
we forward the frame
OUTPUT -
POSTROUTING -
---------------------------------------------------------------------------------------------------------
                                     FILTER
---------------------------------------------------------------------------------------------------------
INPUT -  traversed before passing frame to the upper layers
OUTPUT -  traversed after upper layer OUTPUT chain
FORWARD 
---------------------------------------------------------------------------------------------------------

Note that the ebtables BROUTING and PREROUTING chains are traversed before the bridging decision, therefore
these chains will even see frames that will be ignored by the bridge. 

Note, to enable iptable filtering when ebtables are present, you need to enable
net.bridge.bridge-nf-call-iptables = 1

Can be used with Virtualization therefore you can exposure VM to external world. It can be used to forward
packets between hosts/interfaces , for instance in router there is interface connected to host and to WAN,
to access internet we need to forward packets from host to WAN and vise versa.

Basically, bridging is pugging one computer into another that already has a connection to a large network
(like the internet) and letting the bridged computer use the networked computer`s connection
Setting up bridge =>
brctl add <bridge_name>                     # create bridge
brctl addif <bridge_name> <interfaces ...>  # add interfaces to the bridge

Adding interface to a bridge will cause the interface to lose its existing IP address.

https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg
https://wiki.debian.org/BridgeNetworkConnections
http://ebtables.netfilter.org/documentation/docs.html
http://ebtables.netfilter.org/br_fw_ia/br_fw_ia.html
=========================================================================================================
                              Routing vs Bridging
=========================================================================================================
# TODO, Refactor?
Routing refers to the interconnection of separate and independent networks which have non-overlapping
ranges if IP addresses. Router examines the destination IP to determine which of several connected
networks should receive it, after which the packet is forwarded to the proper network. Therefore routing
allows transactions between hosts that are not at the same logical network while bridging L2 device
works only within one logical network.

Bridging refers to interconnection between separate physical networks that are all carryng the
same range of IP addresses. Hubs and switches are example of bridges, they receive packet on one
port and send it to another


=========================================================================================================
                                      STP
=========================================================================================================
Often for network stability concerns we use redundant links. Idea is next, if one link goes down, we can
use another, maybe it goes up atimatically. However now we face problem of loops in network. For instance,
a switch broadcasts ARP for PC2 on its interface, which will be received by switch2 and if it doesn`t know
about a PC2 (maybe it doesn`t respond at the moment) will resend it to switch1 again. This is called a
broadcast storm.
                 //==========> PC1
Router ======> Switch1
               ||   ||
               ||   ||
               ||   ||
               ||   ||
               Switch2 <======== Router
PC2 =============//

Logical Layer 2 loops may occur due to the natural operation of switches—specifically the learning and
forwarding process. When multiple paths exist between two devices on a network, and there is no spanning
tree implementation on the switches, a Layer 2 loop occurs. A Layer 2 loop can result in three primary issues:
1. MAC database instability. Instability in the content of the MAC address table results from copies of
   the same frame being received on different ports of the switch. Data forwarding can be impaired when
   the switch consumes the resources that are coping with instability in the MAC address table.
2. Broadcast storm—Without some loop-avoidance process, each switch may flood broadcasts endlessly. This
   situation is commonly called a broadcast storm.
3. Multiple-frame transmission—Multiple copies of unicast frames may be delivered to destination stations.
   Many protocols expect to receive only a single copy of each transmission. Multiple copies of the same
   frame can cause unrecoverable errors.

Ethernet frames do not have a time to live (TTL) attribute. As a result, if there is no mechanism enabled
to block continued propagation of these frames on a switched network, they continue to propagate between
switches endlessly, or until a link is disrupted and breaks the loop.

Main aim of STP is to avoid L2 loops in network, it`s done with STA (Spanning Tree Algorithm) which
result in connected graph with no loops.

Note, that 802.1D is quite old/slow and now is commonly replaced with RSTP. For instance, most modern Cisco
switches default to a protocol called Per-VLAN RSTP. It automatically operates a separate spanning tree
domain with a separate root bridge on every VLAN. In practice, it’s common to make the same switch the root
bridge on all or most of the VLANs, though.

https://computer.howstuffworks.com/lan-switch13.htm
---------------------------------------------------------------------------------------------------------
                      How to create topology without loop
---------------------------------------------------------------------------------------------------------
Firstly, we need to root bridge/switch, device that is considered to be center or root node of STP and
a reference point for all path calculations. It is choosen by Bridge ID, 8bytes identifier which consists
of 2byte Bridge Priority (0-65535, by default 32768 + vlan id) and 6 byte MAC address of device.
Bridge Priority is probably vendor specific, it is one value that will be used by default of all vendor
devices, like 32768. Each sent BPDU will contain 2 bridge ids, the first one is sender bridge id and the
second it the bridge id that senders consider to be root. Initially each switch consideres itself to be
root until it receives BPDU with smaller Bridge ID. Therefore, if switch hasn`t received any BPDUs yet,
it consideres itself to be root, and use its id both for sender and root id. When switch receives
such BPDU, if receiver`s id is lower, it continues to consider itself as root, and will overwrite this
value within packet, before forwarding further.

          Bridge ID
    2bytes         6bytes
Bridge Priority |   Mac
Priority can be configured with `brctl setbridgeprio <bridge> <prio>`
If you don`t want some old switch to be root of your network, configure prefered switch to have maximal
priotrity and backup one to be a bit smaller.

When root bridge is choosen, each non-root switch is supposed to choose one port which will point to the
root switch (Root port). Root port is choosen by root path price. It is callculated from count of links
and its bandwidth.  There can be only one root port per non-root switch, otherwise there is loop.
1. Root port sends BPDU with Root Path Cost = 0
2. Receiving switch looks at speed of link and add cost according to table (802.1d)
10 Mbps  => 100 # 100 Mbps => 19 # 1 Gbps   => 4 # 10 Gbps  => 2
3. Received switch resends it to next one and so on.
If there are multiple ports with equal path price, port with the smallest number is choosen.
It can be configured with `brctl setpathcost <bridge> <port> <cost>`

Now we need to choose Designated ports which are allowed to forward traffic. Designated ports are selected
on a per-segment basis, based on the cost of each port on either side of the segment and the total cost
calculated by STP for that port to get back to the root bridge. In case the two or more ports have the
same Root Path Cost, the switch with the lower Sender Bridge ID wins and its corresponding port is selected
as the segment's Designated Port.
If one end of a segment is a root port, then the other end is a designated port.
All ports on the root bridge are designated ports. It is usually not expected that designated ports are
blocked, except when you connect two ports of the same root switch. In such case, they will use default
STP mechanism to determine who get`s designated status and who gets blocked, resulting into
-> Lowest Root Bridge ID = tied
-> Lowest Root path cost = tied
-> BPDU that was sent from the switch with the Lowest Bridge ID = tied
-> Lowest Port number = which cannot be a tie.
Therefore, port with lower id stays alive and another gets blocked. 
(https://www.experts-exchange.com/questions/27490140/Do-BPDUs-return-to-the-switch-to-indicate-a-loop.html?redirect=/questions/27490140/Do-BPDUs-return-to-the-switch-to-indicate-a-loop.html&offering=3035)

Now we want to remove reduntant links to prevent loop. Any port that is not root nor designated gets
blocked.

Alternate port and backup port—An alternate port and a backup port are in a blocking state (or discarding
state) to prevent loops. Alternate ports are selected only on links where neither end is a root port.
Only one end of the segment is blocked, while the other end remains in forwarding state, allowing for a
faster transition to the forwarding state when necessary.

Disabled ports—A disabled port is a switch port that is shut down.

Root Port                    Designed Port
    Router   ==============================   Root Switch
    Designed Port                        Designed Port
      ||                                        ||
      ||                                        ||
      ||                                        ||
     Root Port                              Root port
     Switch   Blocked Port === Designated Port  Router
     Designated Port
      ||
      ||
      PC

https://www.experts-exchange.com/questions/27490140/Do-BPDUs-return-to-the-switch-to-indicate-a-loop.html?redirect=/questions/27490140/Do-BPDUs-return-to-the-switch-to-indicate-a-loop.html&offering=3035
---------------------------------------------------------------------------------------------------------
                                   Messaging
---------------------------------------------------------------------------------------------------------
Switches communicate with special packets called BPDU (Bridge Protocol Data Units). This message is sent
from each port for multicast mac address 01:80:C2:00:00:00, by default every 2 seconds and is listened by
another switches with eneabled STP.

There are two types of BPDU. Configuration BPDU and toplogy change notification BPDU (TCN). Configuration
BPDUs are originated only by the root bridge (not a case for RSTP?), but a TCN BPDU will be generated by
any switch in the network when one of two things happen:
A port has gone into Forwarding mode
A port has gone from Forwarding or Learning mode into Blocking mode

Couple important fields of Configuration BPDU =>
1. Sender identifier (Bridge ID)
2. Root switch identifier (Root Bridge ID)
3. Sending port identifier (Port ID)
4. Path to root switch cost (Root Path Cost) 

---------------------------------------------------------------------------------------------------------
                                    Timings
---------------------------------------------------------------------------------------------------------
Usually, when topology changes, it takes about 50 seconds before STP is finished and packets are again
forwarded. There are some common ways to decrease this time.
Access ports (e.g. ports to which clients are connected and not switches?) should have STP disabled. To
do this, you should set them as portfast (they skip blocking/learning state and are always forwarding) and
also enable bpdufilter on those ports, so they do not participate in STP.

The rapid feature or RSTP is what you’ll probably find most useful. This allows the network to recover
from most failures in times on the order of 1 to 2 seconds.
---------------------------------------------------------------------------------------------------------
                                 Loop Detection
---------------------------------------------------------------------------------------------------------
If switch receives its own BPDU, receiving port is getting blocked.

https://www.experts-exchange.com/questions/27490140/Do-BPDUs-return-to-the-switch-to-indicate-a-loop.html
---------------------------------------------------------------------------------------------------------
                            States of port on bridge 
---------------------------------------------------------------------------------------------------------
1. Blocking. Initial state of port after initialization. Listens for BPDU to know when it needs to ublocked.
2. Listening. Port sends BPDUs but is not allowed to send data.
- not allowed to learn addresses or forward data?
- after forwarding? delay starts to study?
3. Learninig. Port listens and sends BPDU, and changes CAM table, but no data is forwarded.
4. Forwarding. Working state of port, can do anything.
5. Disabled, Dissabled with shutdown command.

State of port is changes 1-4 after initialization, which makes some delay but then device can be sure that
nothing will be broken. Client may think that there is no DHCP in network and self configure during this
timeout. There is option `portfast` which makes prot start in state forwarding for end nodes to avoid such
problems

---------------------------------------------------------------------------------------------------------
                                Port attributes
---------------------------------------------------------------------------------------------------------
Port Priority. Each port of a Switch has a Spanning Tree Port Priority value associated with it, which is
equal to 128 by default and can be changed with `brctl setportprio  <bridge> <port> <prio>`

Port ID. Spanning Tree Port ID is formed by adding the 4-bit port priority value (the default value of 128)
to 12-bit interface identifier (total 16 bits). Normally, a Port ID is denoted in Hexadecimals similar as
0x8015, which is equivalant to 128.21 in decimals, where the first part is the default Port Priority number
and second part is the switch interface identifier.

Forwarding delay. Forwarding delay time is the time spent in each of the Listening and Learning states
before the Forwarding state is entered. This delay is so that when a new bridge comes onto a busy network
it looks at some traffic before participating.
brctl setfd <bridge> <time>

Hello time. Periodically, a hello packet is sent out by the Root Bridge and the Designated Bridges. Hello
packets are used to communicate information about the topology throughout the entire Bridged Local Area Network.
brctl sethello <bridge> <time>

Max age. If a another bridge in the spanning tree does not send out a hello packet for a long period of
time, it is assumed to be dead. This timeout is set with:
brctl maxage  <bridge> <time>

Aging time. How long MAC is saved to FIB after receiving packet with such MAC.
brctl setageing <bridge> <time>

http://williamherry.blogspot.com/2012/05/bridge-by-linux-foundation.html
---------------------------------------------------------------------------------------------------------
                             Configuration example
---------------------------------------------------------------------------------------------------------
Usually you would do following to set up unmanaged bridge
ifconfig eth0 0.0.0.0
ifconfig eth1 0.0.0.0
brctl addbr mybridge
brctl addif mybridge eth0
brctl addif mybridge eth1 
ifconfig mybridge up

If you want to set up managed bridge (with IP), replace `ifconfig up` for dhclient, or
how do you obtain IP

---------------------------------------------------------------------------------------------------------
                          Connecting switch to it self
---------------------------------------------------------------------------------------------------------


---------------------------------------------------------------------------------------------------------
                         BPDU filter vs guard, PortFast
---------------------------------------------------------------------------------------------------------
BPDU is short for the phrase Bridge Protocol Data Unit, which is part of the STP that help describe and
identify attributes of a switch port. BPDUs allow for switches to obtain information about each other.
Some devices and local stacks running on systems/workstations are capable of generating potential STP BPDUs
that cause Denial of Service (DOS) attacks. PortFast and BPDU Guard features provide stability and security
for network topologies to prevent such attacks.

PortFast. Enabling the PortFast feature causes a switch or a trunk port to enter the STP forwarding-state
immediately or upon a linkup event, thus bypassing the listening and learning states. Though PortFast is
enabled the port still participates in STP. If the port happens to be part of topology that could form a
loop, the port eventually transitions into STP blocking mode. PortFast is usually configured on an edge
port, which means the port should not receive any STP BPDUs. If the port receives any STP BPDU, it moves
back to normal/regular mode and will participate in the listening and learning states.

BPDU filter will prevent inbound and outbound BPDU but will remove portfast state on a port if a BPDU is
received. Enabling BPDU filtering on an interface is the same as disabling spanning tree on it and can
cause spanning-tree loops.

BPDU Guard looks for any BPDU’s entering the interfaces that are enabled this feature. The port will
disable as soon as the first BPDU is received, by shutting the port down.

https://medium.com/ken-m-lai/bpdu-filter-vs-bpdu-guard-a112f967798b
---------------------------------------------------------------------------------------------------------
To check that stp is working, issue `tcpdump -vvv -p -n -i <intf> stp`, it is expected that every n seconds
(2 by default), your device will send BPDUs to detect another that`s also transmitting BPDUs

=========================================================================================================
                               VLAN (Virtual LAN)
=========================================================================================================
A VLAN is a logical subnetwork that can group together a collection of devices from different physical
LANs. It can be used to re-partition network for improved traffic managment. VLAN van be managed by router
or smart switch. There is static and dynamic VLANs. Static requires an administrator to assign individual
ports on the network switch to a virtual network. Dynamic VLAN configuration allows an administrator to
define network membershop according to characteristics of the devices themselves rather than their switch
port location

VLAN adds 4byte 802.1Q tag to ethernet frames. The first 16bits of this field contain the hardcoded number
0x8100 that identifies that frame is part of VLAN. The last 12bits contain the VLAN number between 1 and 4096. 

There are 2 types of ports used for VLAN:
Access port => end nodes connects to it. Trafic between port and end node is not tagged. This port is
attached to some VLAN, sometimes this VLAN parameter is called PVID. Traffic passing through this port
from client is getting tagged. Traffic passing to client is not tagged.

Trunk port => port/interface that is allowed to receive and send packet frames for multiple VLANs.
Swith port connected to router is supposed to be able to send frames from multiple VLANs therefore
it is made to be trunk. Another example, two switches with multiple VLANs configured connected to allow
this port carry data of all interfaces between the two switches. Frames passing this port are getting
tagged. 

As well there is native vlan which is never tagged? By default it is vlanid 1. It is used for devices
that don`t know about VLANs.

=========================================================================================================
                                  Multicasting
=========================================================================================================
Multicast => mechanism to distribute information to large audiences over an IP network,
from source client.

Multicase advantages:
1. Used when sending same data (same type of data) to multiple receivers
2. Better bandwidth utilization
3. Less host/router processing
4. Can be used without knowing addresses of receivers
5. Used when simultaneous delivery for a group of receivers is required

Multicast is mostly (only?) runs over UDP therefore it is best-effort delivery. There is no congestion
avoidance, duplicate packets may be generated, out-of-sequence delivery may occur, efficiency issues in
filtering and secutrity.

Types of Multicast applications
1. One-to-many => one host is sending to two or more receivers
2. Many-to-many => any number of hosts sending to the same multicast group; hosts are also members of the group
3. Many-to-one => any number of receivers sending data back to a source (via unicast or multicast)

Multicast addresses are in renage from 224.0.0.0 through 239.255.255.255
Class D [ 1110 | 28bits Multicast Group ID ]
It is not valid to use multicast address as source, only as destination
This calss D is subdivided into next scopes:
1. Local scope                      => 224.0.0.0/24
   Local scope packet has TTL of 1 ,therefore it never crosses more then 1 L2 segment
2. Global scope                     => 224.0.1.0 to 238 255.255.255 or 224.0.1.0/24
   It is further subdivided and can be forwarded by router
   Well-known addresses assigned by IANA (reserved 224.0.0.0/23)
   224.0.0.1  listened by all multicast systems on subnet
   224.0.0.2  listened by all routers on subnet
   224.0.0.4  listened by all DVMPR(olt multicast routing protocol) routers
   224.0.0.13 listened by all PIMv2 routers
   224.0.0.5, 224.0.0.6, 224.0.0.9, 224.0.0.10 used by unicast routing protocols
3. Source specific mutlicast (SMM) scope  => 232.0.0.0/8
4. GLOP (not an abbreviation) => 233.0.0.0/8
5. Administratively scoped address  => 239.0.0.0 to 239.255.255.255
   Private scope used within company internal network
6. Site-local => addresses must remain within their scope, router must not forward packets
   outside of its scope.
7. Organization-local => scope intended to span multiple sites belonging to a single organization

Multicast participents have state.
Client that want`s to receive any traffic for multicast group G is saided to be in state star,G

Yet, it is not clear how traffic from server is received by/sent to the client, and which hosts are our
clients. There are next protocols to send multicast trafic from source to destination =>
IGMP/MLD, PIM, MSDP, MBGP, MOSPF, DVMRP. Currenlty used are IGMP/MLD + PIM.

PRUNE => message sent by one router to another, to stop flooding data on their connection
---------------------------------------------------------------------------------------------------------
                                  IP spoofing
---------------------------------------------------------------------------------------------------------
IP address spoofing is the creation of IP packets with a false source IP address of impersonating another
computing system. This type of attack is most effective where trust relationships exist between machines.
For example, it is common on some corporate networks to have internal systems trust each other, so that users
can log in without a username or password provided they are connecting from another machine on the internal
network (and so must already be logged in). By spoofing a connection from a trusted machine, an attacker on
the same network may be able to access the target machine without authentication.

It is possible to filter packets against spoofing attacks.
Preventing an outside attacker spoofing the address of an internal machien
Ingress filtering => blocking of packets from outside the network with a source address inside the network
Preventing an inside attacker spoofing attacks against external machines
Egress filtering => blocking of packets from inside the network with a source address that is not inside

---------------------------------------------------------------------------------------------------------
                         Peverse Path Forwarding (RPF)
---------------------------------------------------------------------------------------------------------
                         R2         Interface | Network
                        /  \        i2        | 10.1.1.0/24
 10.1.1.1              /    i1
Multicast Host  ====> R1     R4 ===> Multicast Client
  (Sender)             \    i2         (Receiver)
                        \  /
                         R3

To avoid loops in multicast, the receiving router check routing table and check with egress(output) interface
the it would used if it were to send traffic back to the multicast sender. If the interface matches the interface
the multicast packet has just been received on, the packet is accepted, otherwise, it is dropped.
Because R# has routed over interface 2, traffic on interface 1 is dropped.
https://www.fir3net.com/Networking/Protocols/what-is-multicast-reverse-path-forwarding-rpf.html
---------------------------------------------------------------------------------------------------------
                        Source Specific Multicast (SSM)
---------------------------------------------------------------------------------------------------------
SSM is a service model in which in addition to the receiver expressing interest in traffic to a multicast
address, the receiver expresses interest in receiving traffic from only one specific source sending to that
multicast address. By so limiting sources, SSM reduces demands on the network and improves security.
SSM requires that the receiver specify the soirce address and explicitly excludes the use of the (*,G) join
for all multicast groups in RFC 3376, which is possible only in IPv4`s IGMPv4 and IPv6 MLDv2.

? Which protocol is used for data delivery to listeners? or is it protocol independent
=========================================================================================================
                    IGMP (Internet Group Managment Protocol)
=========================================================================================================
It is the network protocol for interconnection between multicast traffic client and clossest router.
There is currently 3 versions of this protocol, the second is most commonly used, and the third is
close to the second. For IP6 there is MDL which works the same way.

---------------------------------------------------------------------------------------------------------
                                  Message flow
---------------------------------------------------------------------------------------------------------
1. Client sends IGMP Membership Report (or Join) to configured group, meaning that it wants to listen traffic
   provided by this group. Packet has TTL of 1
2. Router received Join and remembers the client and add routing entry to multicast routing table
   To list multicast routing table issue `ip mroute show`
3. Now client receives traffic. Router will send IGMP Query to test if there is still active clients, otherwise
   stream is not sent?. By default it is done each minute and sent to 224.0.0.1 - all nodes in subnet
4. Client responses with Join filled with interested group.
   If there was no repsonse for 3 Joins, route for this client is removed, no more trafic is sent to him
5. Client leaves group with IGMP Leave for group address
   We cannot delete route for this interface since there can be multiple clients behind it, therfore router sends
   additional Querie (IGMP Group Specifix Query) to see if there are any active clients 

Note that client won`t response to Querier for 0 to Max Response Time defined in received Query.
This is done, so hundreds of client won`t response simmultaniously when received General Query.
Report is send to group address, therefore all clients can see it and avoid sending another one,
since router is only interested if there is any client.

---------------------------------------------------------------------------------------------------------
                                    Querier
---------------------------------------------------------------------------------------------------------

               / R1 == ####
              /        ####
Client ==> Switch      #### ===> Server
              \        ####
               \ R2 == ####

In such topology multicast trafic would be duplicated by both routers, to avoid this we have choosing
mechanism called Querier. Router that win, will monitor Joins, send Query and react for Leave.

Chossing mechanism:
1. Multiple routers activate IGMP on interface, each considers itself to be Querier
2. Each send IGMP Query into subnet to find client and start competition with other gateways
3. On receive, gateway compares Source IP with it`s IP, one whose IP is the lowest wins and becomes
   Querier, other become Non-Querier
4. Non-Querier starts a timer, which will  reset

---------------------------------------------------------------------------------------------------------
                               Version difference
---------------------------------------------------------------------------------------------------------
V1 had no leave message, duplicate handling was done by upper protocol like PIM, no Querier competition
V3 supports everything that V2 does but there are some changes. Report is send not to group address but
to 224.0.0.22, requested group address is define within packet. This is done for simplification of
IGMP Snooping. SSM (Source Specific Multicast) support was added, client can specify from which hosts
it wants to receive trafic or doesn`t. 

---------------------------------------------------------------------------------------------------------
                                 IGMP Snooping
---------------------------------------------------------------------------------------------------------
IGMP Snooping is a feature for switches to learn what multicast groups are needed on which ports.
Switch will listen IGMP conversation between hosts and routers and maintain a map of which links
need which IP multicast transmission. If nothing on that port has joined that group, the switch will
prune it. This way multicast can be filtered from the links which do not need them, conserving bandwidth
 on those links.

---------------------------------------------------------------------------------------------------------
                                   IGMP proxy
---------------------------------------------------------------------------------------------------------
IGMP proxy can be used to implement multicast routing. It is forwarding IGMP frames and commonly is
used where there is no need for more advanced protocol like PIM. When acting as proxy, the router
performs the host portion of the IGMP task on the upstream interface, as follows:
- When queried sends group membership reports to the group
- When one of its hosts join a multicast address group to which none of its other hosts belong, sends
  unsolicited group membership reports to that group
- When the last of it hosts in a particular multicast group leaves the group, sends an unsolicited?
  leave group membership report to the all-routers group (244.0.0.2)

Features =>
- The simplest way to do multicast routing
- Can be used in topologies where PIM-SM is not suitable for some reason
- Take slightly less resources than PIM-SM
- Ease of configuration

IGMP proxy is not well suited for complicated multicast routing setups and does not support more than
one upstream interface nor detect/avoid routing loops.

https://wiki.mikrotik.com/wiki/Manual:Routing/IGMP-Proxy
---------------------------------------------------------------------------------------------------------
                      PIM (Protocol Independent Multicast)
---------------------------------------------------------------------------------------------------------
PIM has two version (which can be considered as separate protocols)
1. PIM Dense Mode (DM)
2. PIM Sparse Mode (SM)
Idependent means that it is not attached to some concrete unicast routing protocol.

---------------------------------------------------------------------------------------------------------
                                  Programming
---------------------------------------------------------------------------------------------------------
All MFC (Multicast Forwarding Cache) update operations are performed by user-mode process interacting with
the kernel. Interfaces taking part in multicast are saved to  /proc/net/ip_mr/vif and routes to
/proc/net/ip_mr_cache. Column Oifs will be empty, and Iif will be -1 if client leaved during session
and somebody is still sending traffic but it is dropped. Route creation takes some time, therefore
packets are cached. Otherwise there would be drops during route creation process.

https://www.linuxjournal.com/article/6070
http://support.tenasys.com/INtimeHelp_62/multicast.html
=========================================================================================================
                                    Routing
=========================================================================================================
Main purpose of static routing is to route traffic that must not, or should not, go through the defauly
gateway. The default gateway is for any and all traffic which is not destined for the local network and
for which no preferred route is specified in the routing table.

To add static route to a single IP address, issue a command
ip route add <ip> via <next-hop address> [dev <out_intf>]
and add a static route to a netork
ip route add <ip/mask> via <next-hop> [dev <out_intf>]

Address 0.0.0.0/0 matches all IPv4 addresses, therefore it can be used as default route
Gateway 0.0.0.0 means that there is no next-hop gateway and specified network is on the end of the link
There is no need to route such packets and they are sent to out-interface? Otherwise packet for that
destinatio is sent through gateway which will forward them.

When you have more then one default route, one used for sending is choosen by the same algorithm used
for choosing between all routes. This means, active route will be
1. Preferred one
2. If there are multiple with the same preference, then by metric
3. If both preference and metric are equal, then method is OS dependent, but probably the first one
   in the list will be choosen.

ip route show cache         # show cache TODO
ip route flush cache
ip -s route show cache      # statictics



Policy-routing => route that allows to apply multiple rules for packet instead of one destination rule.

Ip route output =>
- netmask
- interface
- proto kernel => route was created automatically by kernel
- scope link => rule works only for one interface (described earlier in result line)
- src => sender
- default => gateway used if trafic doesnt fit netmask

There can be multiple routing tables, default ones are =>
- local => local traffic that shouldn`t go to global network and broadcast IPs
- main => is used when table is not specified
- default => empty by default

To display table
ip route show table <table>
To dispaly all use next table name => all, unspec, 0

Rule table => ip rule
- id => rule will go through all tables (applicable) from low to high id
- condition (can be combined)
* src (from all) => which source packet should go through this routing table
* from
* to
* iif => incomming interface
* oif => outgoing interface (if socket is binded to local interface)
* tos 
* fwmak => smthing with firewall
* not
- lookup => subtable of routing table?
- name 


ip route add default via <ip> table <id>    # will create table with one rule
ip rule add from <ip> table <id>            # will create rule sending packets to table <id>


---------------------------------------------------------------------------------------------------------
                                  Config files
---------------------------------------------------------------------------------------------------------
To configure statuc route when interface goes up, add `up ip route ...` directive under wanted interface
within /etc/network/interfaces. Or create script under /etc/network/if-up...
If you want route to print table with names instead of numbers, you can alliase networks withing /etc/networks

https://unix.stackexchange.com/questions/196830/practical-usage-of-etc-networks-file
---------------------------------------------------------------------------------------------------------
                        OSPF (Open Shortest Path First)
---------------------------------------------------------------------------------------------------------
Dynamic routing protocol build on monitoring link quality that uses dejkstra algorithm of shortest path
search.


Link-State => gateway knows entire topology even behind gateway local to its network. This technology uses
special DB LSDB

Distance-Vector => gateway has information about gateways local to its network and doesnt know theirs topology,
uses metrics.

On boot, route will configure couple loopback interfaces and the highest ip will be used as router id in
packets. Each interface has access to zone identified with ZoneID.
Ospf starts with hello msg sending every 10 seconds to 224.0.0.5 (multicast) When router notices neighbour,
it will send hello with field ActiveNeighbor ip of new gate. New gate will save oldgate as neighbor and send
unicast packet specifying new gate as neighbour. Now they are neighbours and can build LSDB.
LSDB will containg routing information and is supposed be identical on all gates (they will sinc it).

Types of msgs in OSPF:
- Hello => used to detect/relation neghbours 
- Database Description (DBD) => sync detect
- Link State Request (LSR) => request for link state used to sync
- Link State Update (LSU) => response for LSR
- Link-State Ack (LSAck) => ack of another type of packets?

Link State Advertisment (LSA) => unit of data descrining state of gate or network. Set of all LSA describes
LSDB, however it containes different types of LSA. On receive it is require to recalculate path price.
(unless network summary lsa)

Designated router (DR) => controls sending of LSA in network. When new gate is detected , it syncs with DR
wich will update all other gates with LSUpdate to 224.0.0.5 for which other should ack to 224.0.0.6.
Backup Designated router (BDR) => used when DR goes down. DR and BDR are chosen on segment not zone. To
communicate with them multicast address of 224.0.0.6 is used. They are chosen by the highest OSPF interface
priority?  then by the hieghst ID and wount be updated untill one goes down. Gate is considered down
if there was no Hello during RouterDead interval (around 40 sec).

Area Border Router (ABR) => gate that stands on endge of two areas and informes them with Network Summary
LSA (type 3). This message contains path, without topology, but with price therefore we can add price of
ABR path to price received without entire dejkstra recalculation => Partial SPF calculation.

There is always area 0 which is core , that will be pathed through when message goes between any 2 areas
with non 0 id.
---------------------------------------------------------------------------------------------------------
                              Route Redestribution
---------------------------------------------------------------------------------------------------------
Route redistribution => the use of a routing protocol to advertise routes that are learned by some other
means, such as by another routing protocol, static routes, or directly connected routes.

When you redistribute one protocol into another, remember that the metrics of each protocol play an
important role in redistribution ,since each protocol uses different metrics. When you have multiple
routes from different routing protocols, one is choosen by its Administrative Distance.

Administrative Distance (AD) => a value that routers use in order to select the best path when there are
multiple routes to the same destination from multiple routing protocols. AD counts the reliablity of a
routing protocol. It is a numeric value which can range from 0 to 255 where 0 is the best route and
255 is the worst. Note that using routing with AD may cause routing loops, convergence problems, or
inefficient routing.

AD    | Route Type
0     | Connected interface
0/1   | Static Route
90    | Internal EIGRP Route
100   | IGRP route
110   | OSPF route
115   | IS-IS
120   | RIP Route
255   | Unknown ROute

         OSPF    ||    EIGRP
  ... R1  ====>  R2 <====   R3 ...
                 ||


---------------------------------------------------------------------------------------------------------
TODO
 Dynamic Routing protocols
 Remove or refactor  OSPF
 Route redistribution


=========================================================================================================
                    ICMP (Internet Control Message Protocol)
=========================================================================================================
ICMP provides for the delivery of error and control messages that may require attention. It uses IP
protocol for transport so it i sneither a network not a transport protocol but lies somewhere between the
two. It is was used for many hacker attacks therefore usually admins block ICMP on edge routers. This result
is diagnostic utilities like ping/traceroute not working properly.

General form of a packet is
Type => 1byte, code specifing issue
Code => 1byte, more detailed specification
Checksum => 2bytes
All other fields depend on type value.

There are 42 values reserved for Type field and only 8 of these are in regular use.
Messages are divided into 2 categories: those messages relating to problems with delivering IP datagrams
(error messages) ,and those related to information gathering and configuration (query or information messages)

Message types:
0(*) Echo Reply => returns data
3(*)(+) Destination Unrechable => unrechable host/protocol
4 Source Quench => indicates congestion (deprecated)
5(*) Redirect => indicates alternate router should be used
8(*) Echo => Echo(ping) request
9 Router Advertisment => Indicates router address/preferences
10 Router Solicitation => Request Router Advertisment
11 (*)(+) Time Exceeded => resource exhausted
12 (*)(+) Parameter Problem => malformed packet
* Commonly used
+ Extensible


=========================================================================================================
                                      IPv6 
=========================================================================================================
---------------------------------------------------------------------------------------------------------
                                   Addresses
---------------------------------------------------------------------------------------------------------
An IPv6 address consist of 128bits or 16bytes which are divided into next groups:
Network address or Global unicast address  | first 6bytes
Subnet adderss or Subnet id                | next 2bytes
Device address                             | last 8bytes

---------------------------------------------------------------------------------------------------------
                            Address Types and Scope
---------------------------------------------------------------------------------------------------------
Global Unicast Address. Scope Internet, routed on Internet.
Starts with 2001: or 2000::/3? is equivalent of the public addresses of IPv4 networks

Unique Local Address. Scope internal network or VPN, is internally toutable but not
routed on Internet.
The first half of the ULA address range, fc00::/8, is reserved for a future global authority to assign.
The second half of the ULA address range, fd00::/8, can be assigned locally, with restrictions.
The next 40 bits must be randomly chosen, and you cannot assign prefixes in any particular order.
Equivalent for private not self assigned IPv4, like 10.0.0.0/8

Link Local. Scope network link, not routed internally or externally.
Starts with FE80::/10. Is equivalent to the IPv4 address 169.254.0.0/16 which is allocated
on an IPv4 network when no DHCP server is found.

Multicast addresses. Starts with FF00::/8
------------------------------------
Convertions
------------------------------------
IPv4 mapped IPv6
Some applications use ipv4 embedded in an pv6

 :ffff:192.168.1.1/96

6to4
Transition from ip4 to ip6 is done with ip6 tunnel
ip4 will be encoded in ip6 that starts 2002

192.168.1.42/24 => 2002:c0a8:12a:18::1

Routing header RH0 =>
- contains table of ips to go through before destination
- uses left segments field to map into table and decreases
  it on hop-by-hop basis
- is deprecated

=========================================================================================================
                                      DHCP
=========================================================================================================
/TODO some general iformation about protocol, packets, configutatio

DHCP /BOOTP port => 68,67
Lease => configurearion iformation used by host during agreed time

Ip addresses in packet =>
* Your address (yiaddr) => server ip
* Client Hardware Address (chaddr)
* Client IP Address (ciaddr)
* Gateway (Relay) IP (giaddr)

---------------------------------------------------------------------------------------------------------
                                    Messages
---------------------------------------------------------------------------------------------------------
DHCPDISCOVER   # message sent over broadcast to find dhcp server, which will offer IP in response
DHCPOFFER      # response for discover, offers ip for host as well as additional configurations like
                 DNS server, lease time (upper bound) for ip
DHCPREQUEST    # request specifing that client accepts ip
                - sent over broadcast? but with server identifier option
                - can be used directly to update lease
DHCPACK        # response from server, client can use ip on its receive
DHCPNACK
DHCPDECLINE    # client has option to perform DAD(Duplicate Address Detection) and decline ip if test failed
DHCPRELEASE    #
DHCPINFORM     # used by client to request additional information
               # information is send in DHCPACK by server
DHCPFORCERENEW # force client transition to renew state

---------------------------------------------------------------------------------------------------------
                                Renew vs Rebound 
---------------------------------------------------------------------------------------------------------
Client has 2 timer, the first (renew) is shorter one and indicates time when client should
start reqesting lease update from its server When the second timer goes down, client starts
to broadcast that request to all servers
---------------------------------------------------------------------------------------------------------
                                Implementations
---------------------------------------------------------------------------------------------------------
Commonly all Linux distribution are prepacked with some sort of dhcp server/clinet utility. Two most
well know are dhcpd server and dhclient client utilities provided by ISC (Internet Systems Consortium).
ISC DHCP offers a complete open source solution for implementing DHCP servers, relay agents, and clients
both for IPv4 and IPv6. Currently ISC is implementing new set of dhcp related utilities called Kea.

https://www.isc.org/dhcp/
---------------------------------------------------------------------------------------------------------

LCI (Location COnfiguration Information)

APIPA (Automatic Private IP Addressing) =>
- method of dynamic link-local address configuration
- host select random address form private range 
  169.254.1.1 => 169.254.254.254 with subnet /16
  checks if it is not already used and self assigns

* Stateless DHCP - user already got ip but still requires dns
               therefore it asks it from gateway

---------------------------------------------------------------------------------------------------------
                                   DHCP Relay
---------------------------------------------------------------------------------------------------------
DHCP Relay Agent relays DHCP messages between DHCP client and DHCP servers on different IP networks. Since
broadcast trafic is not forwarded by routers? relay agent converts broadcast to unicast and sends it
directly to router, and reverse.
         BROADCAST        UNICAST
Client  ===========>  X  ===========> Gateway
                    RELAY
Client  <===========  X  <=========== Gateway
         BROADCAST        UNICAST
When relay sees broadcasted DHCPDISCOVER, it will change source ip for it own and resent discover to real
server. Next messages from sever will be forwarded to client.

How dhcp server knows which client is relay and which isnt? Internal configuration?
=========================================================================================================
                  DHCPv6 (Dynamic Host Configuration for IPv6)
=========================================================================================================
DHCPv6 is used to delegate IPv6 prefixes and to allocate IPv6 addresses. It offers stateful address
autoconfiguration, and complements Stateless Address Autoconfiguration (SLAAC) described in RFC 2462,
IPv6 Stateless Address Autoconfiguration. Stateless Address Autoconfiguration (SLAAC) allows an IPv6-aware
device to be plugged into a network, and given an IPv6 address prefix without manual configuration.

DHCPv6 Server can =>
Delagete prefix to IPv6 subnets. Prefixes allow subnets to be selected, rather than a signle node.
Assign normal and temporary IPv6 addresses to devices. Normal addresses are renewed by the server
for as long as the device requires an address. Temporary addresses are assigned for a limited time
(lease time) and are usually allocated for privacy reasons, RFC 3041 “Privacy Extensions for Stateless
Address Autoconfiguration in IPv6”.

Provider use DHCPv6 feature to manage site addressing, subnet, and link updates =>
1. Stateless DHCPv6. No DHCPv6 server is needed to maintain any dynamic state for clients such as DNS.
Configuration information is exchanged with stateless Prefix Delegation
2. Stateful DHCPv6. DHCPv6 server centrally manage IPv6 address and prefix assignment.
IPv6 address/ prefix/ additional information is received from server.

---------------------------------------------------------------------------------------------------------
                                    Prefixes
---------------------------------------------------------------------------------------------------------
Network + subnet parts of IPv6 address form an IPv6 Prefix which is used for routing.
Network part is partially assigned by IANA and partially by ISP
Registry Prefix is /23, IANA prefix part
ISP Prefix is /32,  registry prefix extended for ISP
ISP assigned Site prefix is /48, usually is given to entire organizations
Site assigned Subnet Prefix is /64

---------------------------------------------------------------------------------------------------------
                                Prefix lifetime
---------------------------------------------------------------------------------------------------------
IPv6 addresses are leased to an interface for a fixed (possibly infinite) length of time. To handle the
expiration of address bindings gracefully, an address goes through two distinct phases while assigned to
an interface. Initially, an address is "preferred", meaning that its use in arbitrary communication is
unrestricted. Later, an address becomes "deprecated" in anticipation that its current interface binding
will become invalid. While an address is in a deprecated state, its use is discouraged, but not strictly
forbidden. New communication (e.g., the opening of a new TCP connection) should use a preferred address
when possible. A deprecated address should be used only by applications that have been using it and would
have difficulty switching to another address without a service disruption.

Tentative address - an address whose uniqueness on a link is being verified, prior to its assignment to an
interface. A tentative address is not considered assigned to an interface in the usual sense. An interface
discards received packets addressed to a tentative address, but accepts Neighbor Discovery packets related
to Duplicate Address Detection for the tentative address.

Preferred address - an address assigned to an interface whose use by upper-layer protocols is unrestricted.
Preferred addresses may be used as the source (or destination) address of packets sent from (or to) the
interface.

Deprecated address - An address assigned to an interface whose use is discouraged, but not forbidden.
A deprecated address should no longer be used as a source address in new communications, but packets sent
from or to deprecated addresses are delivered as expected. A deprecated address may continue to be used
as a source address in communications where switching to a preferred address causes hardship to a specific
upper-layer activity (e.g., an existing TCP connection).

Valid address - a preferred or deprecated address. A valid address may appear as the source or destination
address of a packet, and the Internet routing system is expected to deliver packets sent to a valid address
to their intended recipients.

Preferred lifetime - the length of time that a valid address is preferred (i.e., the time until deprecation).
When the preferred lifetime expires, the address becomes deprecated.

Valid lifetime - the length of time an address remains in the valid state (i.e., the time until invalidation).
The valid lifetime must be greater than or equal to the preferred lifetime. When the valid lifetime expires,
the address becomes invalid.

The client should attempt to renew the lease before the preferred lifetime ends, but if it is not able to
do so, the address will be deprecated (and the client can continue using it if it doesn't have a preferred
address) until the valid lifetime ends.

      |            |         Valid          |
      |  Tentative | Preferred | Deprecated |   Invalid
Time  |=====================================================>
      |  Preferred Lifetime    |
      |  Valid Lifetime                     |

Prefix configuration are sent with Router Advertisment messages and may include following parametes:
- Valid lifetime (mandatory) - time interval in seconds, default 2592000 seconds (30days)
- Preferred lifetime (mandatory) - time interval in seconds, default 604800 seconds (7days)
- Onlink flag (optional) - the specified prefix is assigned to the link upon which it is advertised
Nodes sending traffic to addresses that contain the specified prefix consider the destination to be
reachable on the local link.
- Autoconfiguration flag --(Optional) If this flag is set, the stateless auto configuration feature can
use the specified prefix in the automatic configuration of 128-bit IPv6 addresses for hosts on the local
link, provided the specified prefix is aggregatable, as specified in RFC 2374. 

https://learningnetwork.cisco.com/thread/124273
https://serverfault.com/questions/798716/ipv6-address-lifetime-preferred-versus-valid-lease
---------------------------------------------------------------------------------------------------------
                               Prefix Delegation
---------------------------------------------------------------------------------------------------------
ISP can handout indeividual addresses as well as entire networks to a customer 
Customer router (Prefix Delegation Client) makes Prefix Delegation reques and receives prefix
from ISP(Prefix Delegation Servcer) for further use. Client may delegate its own prefix even further.
Now requesting router can uses prefixes to assign global IPv6 addresses to the devices on its
internal network

https://www.alliedtelesis.com/sites/default/files/documents/feature-guides/dhcpv6_feature_overview_guide_rev_a.pdf
=========================================================================================================
IA (Identity Association). Identidier used between client and server to refer to collection of
addresses Comprises IAID (IA identifier) and associated configuration information. One IA for interface


DUID (DHCP Unique Identifier). Identifies signe client/server during message exchange


DUID types
* DUID-LLT
- base on link-local address + time

* DUID-EN
- based on enterprise number and vendor assignment

* DUID-LL
- based on link layer only

Bits is RA =>
M (Managed Address Configuration)
- indicates that ipv6 addresses can be obtained using DHCP6
- M = 1 => user performs full dhclient (with dns request?)

O (Other Configuration)
- information other than ip is available
- O = 1 => user receiver ip and performes dhcp information request for 
  extra information like dns


=========================================================================================================
                                 Message types 
=========================================================================================================
Router Solicit      ##  sent by client to all routers multicast address
Router Advertisment ## contains M and O flags
SOLICIT             ## message used to find dhcp6 server after RA
ADVERTISE           ## response to solicit
REQUEST 
INFORMATION-REQUEST ## answered is send with REPLY
                       it contains option-request list
REPLY
=========================================================================================================
                 SLACC (StateLess Address Auto Configuration).
=========================================================================================================
Can generate global ip as well but requires help of router ip will be created from router prefix(carried
as option in RA aswell as flag telling wether it is fine to use it for global address generation) and self
generated information method of self-assigning link-local ip6 address

TODO
=========================================================================================================
                       DAD (Duplicate Address Detection)
=========================================================================================================
Node joins All Nodes multicast address and the Solicited-Node multicast address and send one or more
Neighbor Solicitation messages with target address set to address being checked.If Neighbor Advertisement
is reveiced, DAD failed. If durring solicitation you received solicitation for the same address, then you
skip waiting for Advertisment and DAD is considered to be failed.

TODO
=========================================================================================================
                    NUD (Neighbor Unreachability Detection)
=========================================================================================================
                                      TODO
=========================================================================================================
                         Solicited Node Multicast Group
=========================================================================================================
Multicast address
FF02::1             all nodes                   (reach all nodes on the same link)
FF02::2             all routers                             (-||-)
FF02::5             all OSPF-routers                        (-||-)
FF02::6             OSPF designated routers address         (-||-)
FF02::9             all-RIP routers
FF02::A             all-EIGRP
FF02::1:FFxx:xxxx   solicited-node for reso;ution process 
        ?+ used instead of v4 arp to find gateway with multicast solicitation

TODO
=========================================================================================================
                                      DNS
=========================================================================================================
TODO
query => question asked by dns client

Forward lookup query => client knows domain and asks about ip
Reverse lookup query => client knows ip and wants domain

Recursive query      => client expects complete answer,
        ex. home user tries to open webpage
Iterative query      => client doesn`t expects complete answer
        ex. dns server iterates over tlds till ip is found



Configuration /etc/resolv.conf is hardcoded or send by dhcp

Root Server (~13 in worlds)     .

                        /       |        \
TLDs                .com       .org       .be

                    /
Domains           google.com   ...


Rootserver is many servers logically working as one and responding for anycast
queries


FQDN (fully qualified domain name) => hostname + domain name
    hostname # to see machine hostname
    dnsdomainname # to see domain name

Zone (xone of authority) => partition of dns tree that covers one domain name or
    child domain name. Dns server can be authoritative over >=0 dns zones.
    Zone consists of records (or resource recods)

Records
---------------------------------------------------------------------------------------------------------
A/AAAA ## host record, resovle ip4/ip6 address to hostname 
PTR    ## resolve hostname to ip
NS     ## nameserver record is a record that points to a DNS name server (in this zone)
          You can list all nameservers for zone in distinct NS record
GLUE A ## A record that maps the name of NS to an ip
SOA    ## contains zone meta information (one/zone)
CNAME  ## maps hostname to hostname
MX     ## points to smtp server
---------------------------------------------------------------------------------------------------------

Caching only servers 
 * server with authority over zone that is connected to another server and caches queries
 * do not have zone database with resource records

DnsMasque => utility that used for local (on router) dns requests caching, and as dhcp server
---------------------------------------------------------------------------------------------------------
=========================================================================================================
                            Firewalling and iptables
=========================================================================================================
There are three common types of firewalls and how they function =>
1. NAT (Network Address Translation) =>  places private IP subnetworks behind one or
a small pool of public IP addresses, masquerading all requests to one source rather
than several. Implemented with Netfilter kernel susbsytem
+ Transparent for LAN clients
+ Protection of many machines and services behind one+ external IPs simplifies administration
+ Restiction of user access to and from the LAN can be configured by the opening/closing
  ports in the NAT
- Once users connect to a service outsied of the firewall, cannot prevent malicious
  activity (from which side? service?)
2. Packet Filter => firewall reades each data packet and filters the packet based on sets
of programmable rules implemented by administrator. (Netfilter kernel subsystem)
+ Customizable with iptables utility
+ All network activity is filtered at the router level, rather then on application level
+ Reads header information but not a content
+ Does not require customization from client side
+ Since transmition is not through a proxy performance is faster
- Cannot read packet content like a proxy firewall
- Works on protocol layer, but cannot filter at an application layer
- Taugh to create rules for complex networks like one with DMZ or masqurading
3. Proxy => filters all trafic of configured protocol from LAN client to a proxy machine,
which then forwards trafic on behalve of client. Proxy machine works like a buffer between
malicious remote users and internal network client machine
+ Admin controls applications and protocols function outside of the LAN (can control which
  application and protocols are forwarded or not?)
+ Proxy server can cache requests
+ Service can be logged and monitored for tighter control over resource utilization
- Ofter application specific (HTTP,Telent ...) or protocol-restricted (most work with TCP-connected
  services only)
- Can become a network bottleneck

Firewalls can be statefull or stateless. Statefull is more flexible, since it can remember state of
previous connections. However stateless are much faster.

Built-in chains (nat) =>
# these are permanent and cannot be deleted
1. INPUT - control of incomming connections
2. FORWARD - used for routing, NATing
3. OUTPUT - control of outgoing connections

Built-in targets =>
1. ACCEPT => packet is sent into user space
2. DROP => packet is dropped without error packet
3. REJECT => packet is dropped but an error packet is sent to originator

Each chain has a default policy, what it should do with packet that doesnt fit any of defined rules.
It can either DROP or ACCEPT, and is configured with iptables -P <chain> <policy>.

Changes to rules are temporary, if you want to save changes issue `service iptables save`, rules are
saved to `/etc/sysconfig/iptables` and reapplied whenever service is started or system rebooted with
iptables-restore command.  Existing file is save to iptables.save.
---------------------------------------------------------------------------------------------------------
                                 FORWARD Chain
---------------------------------------------------------------------------------------------------------
ISPs provice a limited number of publicly routable IP addresses to the organizations they serve.
Therefore private IP addresses are used as the common way of allowing all nodes on a LAN to properly
access internal and external network services. Esge routers can receive incoming transmissions from
the Internet and route the packets to the intended LAN node. This forwarding of network traffic can
become dangerous at times and to prevent this, iptables provides routing and forwarding policies that
can be implemented to prevent abnormal usage of network resources. The FORWARD chain allows an admin
to control where packets can be routed within LAN.

LAN nodes using internal IP can communicate with each other, however they can properly communicate with
external networks. This can be overcome with firewall IP masqueradung, whicj masks requests from LAN nodes
with the IP address of the firewall`s external device
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

To allow access to internal service from external network, use PREROUTING chain with DNAT target.
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 172.31.0.23:80
forwards http connections to dedicated Apache HTTP Server at 172.31.0.23
This is commonly used in DMZ to give access to common services that are not so critical to protect 

There is option to inspect and restrict connections to services based on they connection state.
There are 4 connection states =>
1. NEW => a packet requesting a new connection
2. ESTABLISHED => a packet that is part of an existing connection
3. RELATED => a packet that is requesting a new connection but is part of an existing connection
For example FTP establish a connection using port 21, but data is transderred on port 20
4. INVALID => a packet that is not part of any connections in the connection tracking table

---------------------------------------------------------------------------------------------------------
                                   Netfilter
---------------------------------------------------------------------------------------------------------
Netfilter facility is built in to the Linux kernel, and has five built-in tables
or rules lists =>
1. filter => default table for handling packets
2. nat => alter packets that create a new connection and used for NAT
3. mangle => specific types of packet alteration
4. raw => configuring exemptions? from connection tracking in combination with NOTRACK target
  packet was only received for interface and no routing was managed yet
  on packet marking when sending ??
5. security => 

Each table has a group of built-in chains, which correspoond to the actions performed on the
packet by netfilter.

Filter is used for filtering trafic, allowing and banning connections and packets.
This is the default table when no other is specified. Chains =>
1. INPUT — Applies to network packets that are targeted for the host.
2. OUTPUT — Applies to locally-generated network packets.
3. FORWARD — Applies to network packets routed through the host.

Nat table alliws to route packets to different hosts on NAT networks by changing source and
destination addresses of packets, only allowed action here is MASQUEADE. Chains =>
1. PREROUTING — Applies to network packets when they arrive.
2. OUTPUT — Applies to locally-generated network packets before they are sent out.
3. POSTROUTING — Applies to network packets before they are sent out. 

Mangle => used for packet classification, marking of packets/connections and modifying
packet headers. Chains =>
1. INPUT — Applies to network packets targeted for the host.
2. OUTPUT — Applies to locally-generated network packets before they are sent out.
3. FORWARD — Applies to network packets routed through the host.
4. PREROUTING — Applies to incoming network packets before they are routed.
5. POSTROUTING — Applies to network packets before they are sent out.

Raw => used for working with packets before they are provided to conntrack, conntrack
conditions won`t work here. Chains =>
1. PREROUTING — the first chain visited before any other
2. OUTPUT — same as for packets generated by host

Every network packet received by or sent from a Linux system is subject to at least one table.
However, a packet may be subjected to multiple rules within each table before emerging at the
end of the chain.

Some protocols provide specialized matchind options which can be configred to match
particular packet using that protocol. However, the protocol must first be specified
in the iptalbes command with -p option. Addtional match options are available through
modules loaded by the iptables command using -m 'module_name' flag. For instance
there is state module which enables state matching.

---------------------------------------------------------------------------------------------------------
                                     Scheme
---------------------------------------------------------------------------------------------------------
==> PREROUTING ==> Routing Decising ==> FORWARD ==> POSTROUTING ==>
                       ||                            /\
                       \/                            ||
                      INPUT ==> Local Process ==> OUTPUT



        |==============|
        |  PREROUTING  |
        |              |        |==============|
  /=====>     raw      |        |    INPUT     |
  |     |  PREROUTING  |        |              |
  |     |      |       |   /====>   mangle     |
  |     |  connection  |   |    |   INPUT      |
  |     |   tracking   |   |    |      |       |
  |     |  (conntrack) |   |    |   filter     |
  |     |      |       |   |    |   INPUT      |
  |     |    mangle    |   |    |      |       |
  |     |  PREROUTING  |   |    |  connection  |
  |     |      |       |   |    |   tracking   |
  |     |     nat      |   |    |  (conntrack) |
  |     |  PREROUTING  |   |    |      |       |
  |     |      |       |   |    |==============|
  |     |==============|   |           |
  |            |           |           |
  |         ROUTING =======/     Local Process
  |            |                       |
  |     |==============|            ROUTING
  |     |   FORWARD    |               |
  |     |      |       |        |==============|
  |     |   mangle     |        |    OUTPUT    |
NETWORK |   FORWARD    |        |      |       |
  |     |      |       |        |     raw      |
  |     |   filter     |        |    OUTPUT    |
  |     |   FORWARD    |        |      |       |
  |     |      |       |        |  connection  |
  |     |==============|        |  tracking    |
  |            |                |  (conntrack) |
  |         ROUTING <======\    |      |       |
  |            |           |    |    mangle    |
  |     |==============|   |    |    OUTPUT    |
  |     | POSTROUTING  |   |    |      |       |
  |     |      |       |   |    |     nat      |
  |     |   mangle     |   |    |   OUTPUT     |
  |     | POSTROUTING  |   |    |      |       |
  |     |      |       |   \====|   filter     |
  |     |     nat      |        |   OUTPUT     |
  |     | POSTROUTING  |        |              |
  |     |      |       |        |==============|
  |     |  connection  |
  |     |   tracking   |
  \=====|  (conntrack) |
        |              |
        |==============|

https://goyalankit.com/blog/iptables
---------------------------------------------------------------------------------------------------------
https://stackoverflow.com/questions/12945233/iptables-forward-and-input
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html-single/security_guide/index#sect-Security_Guide-Firewalls-Using_IPTables
https://ru.wikibooks.org/wiki/Iptables#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B
https://www.booleanworld.com/depth-guide-iptables-linux-firewall/
http://vasilisc.com/21-examples-iptables



=========================================================================================================
                    SNMP (Simple Network Managment Protocol)
=========================================================================================================
SNMP consists of three key components:
- managed devices
- agents
- network managment systems (NMSs)

A managed device resides on a managed network, this can be an router, switch, bridge, hub, computer host,
printer, and all kinds of IoT devices using SNMP. It has an SNMP agent installed on it.

An  agent is a software module that translates device information into an SNMP compatible format in order
to make the device information available for monitoring with SNMP.

A network managment system runs monitoring applications.

SNMP works within the specification of the Structure of Management Informarion (SMI) and currently has 3
version. Different manufacturers used different versions for their devices. It operates over UDP, IP, CLNS,
DDP, IPX.

---------------------------------------------------------------------------------------------------------
                                  MIB and OIDs
---------------------------------------------------------------------------------------------------------
MIB (Management Information Base) => collection of definitons that define the properties of the managed
object within the device to be managed. Object information is organized hierarchically and can be accessed
by SNMP.

OIDs (Object Identifiers) => uniquely identify managed objects in the MIB

On a switch, the typical objects of interest are the incoming and outgoing traffic, as well as the rate of
package loss, or the number of packets addressed to a broadcast address. Every single object has its own
object ID.

The MIB is organized hierarchically and can be depicted as a tree with different levels from the root to
the single leaves. Each OID has an address that follows the levels of the OID tree. Generally, an OID is
a long sequence of numbers that code the nodes, and are separated by dots. Here is a sample structure of
an OID:

Iso(1).org(3).dod(6).internet(1).private(4).transition(868).products(2).chassis(4).card(1).slotCps(2)­.
-cpsSlotSummary(1).cpsModuleTable(1).cpsModuleEntry(1).cpsModuleModel(3).3562.3

or just

1.3.6.1.4.868.2.4.1.2.1.1.1.3.3562.3.

https://kb.paessler.com/en/topic/653-how-do-snmp-mibs-and-oids-work
=========================================================================================================
                                   Tunneling
=========================================================================================================
Commonly used interfaces are IPIP, SIT, ip6tnl, VTI, VTI6, GRE, GRETAP, GRE6TAP, FOU. GENEVE, ERSPAN, IP6ERSPAN
---------------------------------------------------------------------------------------------------------
IPIP is used for connecting of private ip4 subnets over internet. It has minimal network load but you can`t
use it with multicast, only unicast. This tunnel supports IP over IP and MPLS over IP modes.

| Ethernet | IP4 Header (Proto IPIP) | Inner IP4 Header | Payload |

---------------------------------------------------------------------------------------------------------
SIT (Simple Internet Transition). Tunneling technology used for connecting isolated IP6 networkss over
internet using IP4.

| Ethernet | IP4 Header | Inner IP4 Header | Payload |

---------------------------------------------------------------------------------------------------------
VTI (Virtual Tunnel Interface). Moslt works like IPIP but is used with IPsec incapsulation/decapsulation 

---------------------------------------------------------------------------------------------------------
GRE (Generic Routing Encapsulation). Can encapsulate any L3 packets (for instance IPIP incapsulates only
IP packets), as well can be used with multicast?. As well for L2, there is GRETAP

| Ethernet | IP4 Header (Proto GRE)| GRE Header | Inner IP Header | Payload |     GRE
| Ethernet | IP4 Header (Proto GRE)| GRE Header | Inner Ethernet Header | Inner IP Header | Payload | TAP
---------------------------------------------------------------------------------------------------------
FOU (foo over UDP). It is expected that more devices know how to work with L2 UDP then IP therefore data
can be sent over short path with better performance.

| Ethernet | IP4 Header | UDP Header | Inner IP/GRE Header | Payload |
---------------------------------------------------------------------------------------------------------
GUE (Generic UDP Encapsulation). FOU but with additional header which holds some data about protocol
and else. 

https://habr.com/ru/company/ruvds/blog/457386/

=========================================================================================================
                         VPN (Virtual Private Network)
=========================================================================================================
Maybe you will want to give access out of your office to ur internal network in this case u`ll need a VPN.
It works as client-server architecure => You will have VPN server (endpoint) which contains ifromation
about client that are allowed to connect to VPN. On client device you will install client application
and use it`s data to allow access.
You need to have decent upload speed if there is somebody who is joining your network, so he is not
seeing lags.

VPN is a logical service since there are phisical servers like RADIUS that doesnt do anything
else except allow to connect remotly
---------------------------------------------------------------------------------------------------------
                                   Tunelling
---------------------------------------------------------------------------------------------------------
Process or creating logical connection between two endpoints using protocol encapsulation.
This means that we take some packet from sender, at some point in network encapsulate it in another
secure packet, and send through internet to endpoint. When packet is received by endpoint network,
encapsulation layer is removed and packet is resend withing destination network.


---------------------------------------------------------------------------------------------------------
For VPN tunel encription we use following technologies => IPSec, OpenVPN, PPTP (Point-to-Point Tunelling
Protocol). The most widespread is IPSec which is not protocol but standart specifing three protocols with
next functionality =>
1. ESP (Encapsulating Security Payload). Data encription, source authentification, received data error checking.
2. AH (Authentication Header). Authenification of source, received data integrity
3. IKE (Internet Key Exchange). Used for IPSec SA(Security Association) creation. Users of this protocol
   negotiate which encryption algorithm (if any at all)  will be used.

=========================================================================================================
                                       TR
=========================================================================================================
Technical Report 069 (TR-069) => specification of the Broadband Forum that defines an application layer
protocol for remote management of CPE connected to an IP network. The CWMP define support functions for
auto-configuration, software or firmware image managment, software module management, status and performance
managements, and diagnostics.

Most of the configuration and diagnostics is performed through setting and retrieving the value of the
device parameters. These are organized in a well defined hierarchical structure that is more or less
common to all device models and manufacturers.  This datamodel standarts are published by Broadband Forum.
Supported standars and extendsions should be marked in the device data model in field like
`Device.DeviceSummary` or `InternetGatewayDevice.DeviceSummary`

Technical Report 181 (TR-181) => version 2 of the TR-069 device data model created in order to resolve some
fundamental limitations in the InternetGatewayDevice:1 data model

https://www.broadband-forum.org/download/TR-181_Issue-2_Amendment-2.pdf
=========================================================================================================
                                  Mail Servers
=========================================================================================================
Mail server is a server that handles and delivers e-mail over a network, usually over the internet. When
you send mail usnung e-mail client, it will connect to a server on the network called SMTP (Simple Mail
Transfer Protocol). SMTP is used when mail is delivered from client to server and from server to server.
To download mail, you will connect to server and issue download request with POP3(Post Office Protocol
version 3) protocol. Usually you are using email server provided by your ISP and most likely you won`t
have access to email server of another ISP since they are highly firewalled and won`t provide access for
IP from another network.

To find receiver mail server, sender server will look at receiver domain name and resolve it.
Owner of the resolved IP handles the SMTP server?

https://www.samlogic.net/articles/mail-server.htm

=========================================================================================================
                               URI vs URL vs URN
=========================================================================================================
URI(Uniform Resource Identifier). String of characters that unambiguosly identifies a particular resource.
To stay unambiguos, all URIs follow a predefined set of syntax rules, also extensibilty is maintained
through a separately defined naming scheme (e.g. http://). Such indetifiers allow interaction with
representation of the resource over a network. Scheme specify a concrete syntax and associated protocols
define each URI. The most common form of URI is URL and more rarely URN, which was designed to add
resource identifier namespaces.

It can be a name, locator, or both for an online resource where a URL is
just the locator. URLs are a subset of URIs

URL(Uniform Resource Locator) is a URI that specifies how to obtain resource , i.e. both its primary
mechanism and network location. For example, http://example.com/res refers to resouce identified as res
and in form of HTML related code it is obtained via the http: from a network whose domain name is
example.com

URN(Uniform Resource Name). URI that identifies a resource by name in a particular namespace.
URN may be used to talk about a resource without giving location or how to access it. URN for a book may
look like `urn:isbn:0-486-12345-4`, here isbn is the namespace.

URI identifies a resource either by location, or a name, or both.
A URI is an identifier for some resource, but a URL gives you specific information as to obtain that
resource. A URI is a URL and it is now considered incorrect to use URL when describing applications.
Generally, if the URL describes both the location and name of a resource, the term to use is URI. Since
this is generally the case most of us encounter everyday, URI is the correct term.

https://webmasters.stackexchange.com/questions/19101/what-is-the-difference-between-a-uri-and-a-url
https://damnhandy.com/2007/11/19/uri-vs-url-whats-the-difference/
https://www.keycdn.com/support/comparing-uri-vs-url
=========================================================================================================
                                      HTTP
=========================================================================================================
HTTP (Hypertext Transfer Protocol) is an application protocol for transmitting hypermedia documents, such
as HTML. It defines how messages are formatted and transmitted, and what actions Web servers and browsers
should take in resposne to various commands. It is a stateless protocol, meaning that the server does not
keep any data(state) between two requests, however, some web applications implement states or server side
sessions using cookies or hidden batiables whithin web form.

HTTP resources are indentified and located on the network by URLs (Uniform Resource Locators), using the
URI`s(Uniform Resource Indentifiers) schemes http and https. 

Scheme|  | Userinfo     | |    Host       | |Port | | Path  | |           Query             | Fragment
---------------------------------------------------------------------------------------------------------
http:  // login:password @ www.example.com :  123  /  forum/ ?  tag=networking&order=newest#  top
---------------------------------------------------------------------------------------------------------
        |       Authority                         |


---------------------------------------------------------------------------------------------------------
                                 Requst methods
---------------------------------------------------------------------------------------------------------
The client sends requests to the server and the server sends response. Request message consists of the
following:
- a request line (GET /images/tmp.png which requests a image from the server)
- request header fields
- an empty line
- an optional message body
Node that lines in message must be finished with <CR><LF> no other nul variant.
Desired action performed on specified resource is name method. Desired method is sent withing message
and it is case sensitive in contrast to header field names which are case-insensitive. Number of methods
is not limited and new methods can be added without breaking existing infrastructure. 
Common methods:
1. GET. Requests specified resource. Should be used only for data retrieve and should have no other effect.
2. HEAD. Requests for response identical to that of GET request, but without response body. Used to retrive
   meta-information in response body without transporting entire content
3. POST. Requests server to accept the entity in the reqest as a new subordinate of the wev resource identified
   by the URI. This can be item to add to a database, item identifying behavior of server ...
4. PUT. Requests server that enclosed entity be stored under the supplied URI. If the URI refers to an
   already existing resource, it is modified; if the URI does not point to an existing resource, then the
   server can create the resource with that URI.
5. DELETE. Deletes the specified resource
6. TRACE. Used to see if any changes are made by intermediate servers
7. OPTIONS. Returns the HTTP methods that the server supports for the resource
8. CONNECT. Request connection to a transparant TCP/IP tunnel, usually to facilitate SSL-encrypted communication
   through an unencrypted HTTP proxy.


=========================================================================================================
                                     Proxy
=========================================================================================================
Proxy server is a server that send trafic on behalf of client to preserve client anonymity. This provides
additional benfits of: caching, there can be multiple clients behind proxy and server can cash requested
data; blocking unwanted sites; geofencing. Disadvantages: proxy server knows your ip and what you are
requestiog from internet; if traffic is not ecrypted, it can be seen by nodes between client and server,
therefore it is preferable to use secure versions of protocol like https instead of http; server can
always read requsted/received data since even when you encrypt it, server reencripts it on the path
to destination; you need to trust your provider. Both VPNs and the Tor Network are specific examples of
encrypted proxies.

To demultiples connections, proxy accepts connection from client and opens new to the destination, then
they are programatically associated (like saved to pair...). To avoid port collision for case with
multiple requests, you will need more sophisticated algorithm.

Client \
        \
Client ========> Proxy Server =====> Internet
        /
Client /

There are free and private proxy servers. Free ones are often runned by criminals or are simply not safe.
Individuals or companies can run their own private proxy servers for their personal use, or the use of their
staff. Usually private means that proxie offer use of their service for fee. VPNs are the most common form
of private commercial proxy.

TODO how to make proxy server from ubuntu

---------------------------------------------------------------------------------------------------------
                             Types of Proxy Servers
---------------------------------------------------------------------------------------------------------
1. HTTP Proxy. This is proxy 
   It interprets network traffic. This allows it to do high-level things with the traffic, such
   as searching its cache to see if it can serve a response without going to the destination. Or consult
   a whitelist/blacklist to see if a URL is allowed.
   Note that http tunelling can be implemented without CONNECT.
2. HTTPS Proxy. This type of proxy create a HTTP tunnel using CONNECT method. Client asks an proxy
   server to forward TCP connection to the desired destination. Server makes the connection on behalf of
   the client. Once the connection is established, server continues to proxy the TCP stream to/from client.
   Only initial request is HTTP, after that, the server simply proxies the established TCP connection.
3. SOCKS (Socket Secure) Proxy. 


---------------------------------------------------------------------------------------------------------
                                 Reverse Proxy
---------------------------------------------------------------------------------------------------------
A reverse proxy server requests network resources on behalf of a client from destination servers.
This method provides next benefits: load balancing, caching, isolating internet trafic, logging, canary
deploy. For instance, it can be used when streaming content from internal network services to Internet
users.
                                            / Service
                                           /
Client ========> Reverse Proxy Server ======= Service
                                           \
                                            \ Service


=========================================================================================================
                                      WiFi
=========================================================================================================
Wireless STA (station) => any device that join a WiFi network
RF => radio frequency

BSS(basic service set) => two or more STA connected and controlled with wireless medium (such as a NIC)
that communicate with each other.

IBSS (independent BSS) => stations communicate directly with each other therefore must be within direct
communication range

ESS(extended service set) => DS (Distribution System) + and two plus BSS

BSSID => 48 bit id that identifies bss, used for filtering in frames
- in a infrastructure BSS it will be MAC of wireless interface
- in IBSS it is generated
- all 1s is broadcast BSSID (send by station to identifie network with 
probe request). Only probe frames are allowed to use broadcast

SSID => 48 bit service set identity

IAPP (inter-access point protocol) => method of cominicating association info
Station can be associated only with one AP a time therefore other should be notified.

CF (coordination function) which determines when a STA transmits/receives


Operatiog Modes
- infrastructure
- ad-hoc => pear to pear connection

 Positive acknowledgment => all transmitted frames must be acknowledged, it trasfer
is failed, the frame is considered lost

RTS => Request to send
- reserver radio link for transmission + silences any stations that hear it
- if target hears it , sends back CTS (Clear to send) + silence
 ? Why we need to silence neighbours =>
   wifi link is half duplex therefore if there is hidden node between 
   stations and it receives RTS from two station trying to initiate connection
   it will collide, therefore we want only 1 station to speek a time
- after RTS/CTS any frames must be positively acknowledged
- this mechanism is expansive therefore it is only used in high-capacity 
  environments or can be configured to be applied form big frames


DCG => distributed coordinative function
- checks that link is clear before transmiting
? What is the difference between this and coordination functions

Ways of controlling wireless medium
- DCF (distributed coordination function)
- PCF (point coordination function)
- HCG (hybrid)

CCA => clear channel assertment
- physical way of checking channel

Carier sensing =>
- used to determine if the medium is available

NAV (Network Allocation Vector) =>
- virtual way of checking a channel
- timer on host that accumulates time need to send frame(s)
- time filed within frame send that reserves a medium
- shorter NAV is sent with CTS in case some station missed NAV in RTS
- ACK resets medium NAV

Interframe spacing =>
- SIFS (Short interframe space) => used for highest priority transmissions. They can begin
as soon, as SIFS finishes
- PIFS ( PCF interframe space ) => used by stations with data to transmit in the contention-
free period
- DIFS ( DCF interframe space ) => 
- EIFS => used when there is an error in frame trasmission



NULL data frame =>
- data frame used by STA to notify AP about going to sleep
- it sets PM(Power Managment) bit to 1
- AP never sends this frame nor gos to sleep
- AP will buffer all frames for this STA

PS-Poll (PowerSave-Poll) frame =>
- frame sent by STA when waking up from sleep
- asks AP to send buffered frames
- AP can acknowladge this frame without sending data if it wants.
  In this case STA cannot sleep untill AP sends data
- Data end is notified with special frame beacon
- It doesnt update NAV but all stations receive it and update NAV for
  short  interframe space by themselves
- Instead of NAV is send AID (Association ID ,in range 1 - 2007)

Managment frame =>
* Beacon =>
- annouunce the existence of a network

* Probe Request =>
- is used by STA to find networks
- contains SSID and STA supported rates 

* Probe Response =>
- frame send to probe request
- is sent by STA that was last to send beacon

* ATIM (announcement traffic indication map) =>
- is sent in IBSS if STA has buffered frames
 to notify sleeping receiver

* Disassociation and Deauthentication
- sends reason code

* Association request =>

* Reassociation Request =>
- includes current AP address so new one can communicate with it
  and ask for STA information

* Association response and reassociation response

* Authentication


Managment architecture =>


---------------------------------------------------------------------------------------------------------
                                  Bandsteering 
---------------------------------------------------------------------------------------------------------
Feature that encourages dual-band-capable clients to stay on the 5ghz band on dual-band APs. If client
conects to 5GHz we remeber it and then miss requests for reassosiation with 2GHz. After 8 probe request
in 10 secconds, client is allowed to associate with 2.4GHz AP.
Band steering feature automatically selects between 80MHz, 40 MHz or 20 MHz channels in 802.11n networks?
When AP hears a request from a client device to associate on both the 2.4GHz and 5GHz bands, it steers
the client by responding only to 5GHz association request and not the 2.4GHz. Note that both APs on
gateway are supposed to have the same configuration, like SSID name, security type and settongs, VLAN
assignments. If they all matchm then it may get enabled automatically or there will be option to be
enabled by user. 

AP may be configured in one of the following modes =>
1. Prefer 5GHz
2. Force 5GHz
3. Band Balance

The main problem of steering is that it is not standartized therefore each vendor has it`s own
impelementation and modes of running, as said above. As the result, network connection may be not reliable
for some devices, or they may prefer 2.4GHz band when 5GHz is optimal.

---------------------------------------------------------------------------------------------------------
                               Measurement units
---------------------------------------------------------------------------------------------------------
RSSI (received signal strength). 8bit value arbitrary used by vendor to describe signal strength. There
is no standart for its measurement therefore it is not valid to compare rssi used by different manufactures.

RCPI (received channel power indicator)

RSNI (received signal-to-noise indicator)

---------------------------------------------------------------------------------------------------------
                                  Wifi Roaming
---------------------------------------------------------------------------------------------------------
When a wireless client moves around in an area with multiple AP, it may automatically switch to another
AP which has better signal strength. In this case APs are required to have the same SSID and prorection
configuration. Decision whether to roam or not is client choise. However, on some gateways there is
AP-Assisted Roaming optionl which will kick of sticky clients and make them transfer to the optimized
connection.

---------------------------------------------------------------------------------------------------------
                                    Hotspot
---------------------------------------------------------------------------------------------------------
Hotspot => referes to physical location typically public places served by an AP used to connect devices to
one another using WiFi; friendly/marketing term to qualify an AP that offers wifi access for guest users.
If your AP has open SSID (no password?) then it can be considered an Hotspot; A hotspot is a common public
application of WAPs, where wireless clients can  connect to the Internet without regard for the particular
networks to  which they have attached for the moment

https://community.cisco.com/t5/other-wireless-mobility-subjects/difference-between-quot-access-point-solution-quot-and-quot-hot/td-p/1662032
---------------------------------------------------------------------------------------------------------
                                  Wifi bridge
---------------------------------------------------------------------------------------------------------
In case you need to connect to networks over wireless connecton you can create a bridge.
To do this you need one router wich is connected to internet or just one network router and antwork
that should be connect need a wireless access point (not a router) that will be assosiated with
previous router. This AP should to be run in the bridge AP mode in which it will communicate only with
your configured router

TODO
---------------------------------------------------------------------------------------------------------
                      Wifi booster vs repeater vs extender
---------------------------------------------------------------------------------------------------------
Booster => extends wifi network coverage space by boosting or amplifying existing signals.

Repeater => wirelessly connected to your network, receive the wireless signal from your router
and then repeat that signal to a new area extending WIFI coverage. It doesnt require
physical connection. It will conect to your route and client simultaniously, therefore available
bandwidth is cut in half.

Extender => physically connected to your network via a wired connection, offering much faster
speed and a stronger coverage. These device acts as another wireless router. They therefore
create a different network to transmit coverage, which means they can operate on a different
frequency from your existing router. You will have to deal with manually switching your connected
device`s WIFI connection to the right SSID.

Note that extender can perform repeater functions.
---------------------------------------------------------------------------------------------------------
                       DFS (Dynamic Frequency Selections)
---------------------------------------------------------------------------------------------------------
DFS is a WiFi function that enables WLANs to use 5GHz frequencies that are generally reserved for radars.
Main benefit of using DFS channels is to utilize under-serviced frequencies to increase the number of
available WiFi channels. Firstly AP checks that no radar is using DFS frequencies. This process is
called Channel Availablity Check. If there is a radar on a channel, channel will be ignored for next
30 min and then repeated  Availability Check can take anywhere between 1 and 10 minutes, depending on
which country you`re in.  If AP detectes radar on used channel, it will contact associtated WiFi clients
to stop transmitting on that channel and try to change DFS channel.

http://wifinigel.blogspot.com/2018/05/the-5ghz-problem-for-wi-fi-networks-dfs.html
https://en.wikipedia.org/wiki/List_of_WLAN_channels
https://netbeez.net/blog/dfs-channels-wifi/
---------------------------------------------------------------------------------------------------------
                                  Beamforming
---------------------------------------------------------------------------------------------------------
A common feature for high-end 802.11ac wireless routers. There’s no downside to getting beamforming, aside
from the money you may have to spend to get a more expensive router with this feature. Note that your
device is supposed to support 802.11ac, othrewise this feature can`t be used.

---------------------------------------------------------------------------------------------------------
                                      Mesh
---------------------------------------------------------------------------------------------------------
WMN (Wireless Mesh Network) => network made up of radio nodes organized in a mesh topology. 

=========================================================================================================
       WPS (Wi-Fi Protected Setup, originally Wi-Fi Simple Configuration)
=========================================================================================================
WPS is a network security standard to create a secure wireless home network;
is a method of connecting to gateway without knowing its password. This is commonly used for first
time logging, therefore client can reconfigure password. This is done via an external or internal
registrar. These methods include:
1. Push Button (PBC), external registrar. User has to push a button, either an actual or virtual one, on
   both the access point and the new wireless client device. On most devices, this discovery mode turns
   itself off as soon as a connection is established or after a delay (typically 2 minutes or less),
   whichever comes first, thereby minimizing its vulnerability.
   Method is optional.
2. PIN entry. A unique PIN  will be required for each device to join the network. A fixed PIN label or
   sticker may be placed on a device, or a dynamic PIN can be generated and shown on the device's display
   (e.g., a TV screen or monitor). PIN is used to make sure the intended device is added to the network
   being set up and will help to avoid accidental or malicious attempts to add unintended devices to the
   network. Method is required to be implemented.
3. Near Field Communication (NFC). Usually not used nor is required to be implemented.

Wi-Fi Simple Configuration defines new 802.11 information elements (IE) that are included in beacons,
probe requests and probe responses. The purpose of these IEs is to advertise the presence of devices that
are capable of performing Wi-Fi Simple Configuration operations.

Definitions used in architecture:
1. Domain. A set of 1+  devices controlled by a common authority for the purpose of gaining access to 1+ WLANs.
2. Enrollee. A device seeking to join a WLAN Domain. Once an Enrollee obtains a valid credential, it
   becomes a Member.
3. In-band. Data transfer using the WLAN communication channel
4. Out-of-band. Data transfer using a communication channel other than the WLAN
5. Registration Protocol. A Registration Protocol is a (logically) three party in-band protocol to assign
   a Credential to the Enrollee. The protocol operates between the Enrollee and the Registrar and may
   receive support through a proxy.
6. Registrar. An entity with the authority to issue and revoke Domain Credentials. A Registrar may be
   integrated into an AP (internal Registrar), or it may be separate from the AP (external Registrar).
   A Registrar may not have WLAN capability.  A given Domain may have multiple Registrars.
7. External Registrar. A Registrar for an AP’s Domain that runs on a device separate from the AP
8. PushButton Configuration (PBC). A configuration method triggered by pressing a physical or
   logical button on the Enrollee and on the Registrar.

Some wireless access points have a dual-function WPS button, and holding this button down for a shorter
or longer time may have other functions, such as factory-reset or toggling WiFi.

http://junyelee.blogspot.com/2014/11/wi-fi-protected-setup_4.html
https://kb.netgear.com/19824/How-do-NETGEAR-Home-routers-defend-WiFi-Protected-Setup-PIN-against-brute-force-vulnerability
---------------------------------------------------------------------------------------------------------
                               Managment packets
---------------------------------------------------------------------------------------------------------
The Wi Fi Beacon management frame is a sent out by the access point every 100ms (can be configured).
Beacon frames are used to advertise that the existence of a wireless access point is available and contains
all the required information required to connect to the network. It contains follwing information:
1. Beacon Interval. Interface at which beacons are transmitted by AP, needed by devices in power save mode
   so they wake only when needed.
2. Timestamp. This details the local time of the access point so all local device can use this information
   to synchronize their time.
3. SSID. This field details the network name associated with the access point. If the network is hidden
   then there will be no information in this field. A client will need to know the SSID in its probe
   request, if it wants to connect to this access point.
4. Supported rates. This determines the supported data rates by the access points
5. Parameter sets. This describes the supported signaling rates i.e frequency hopping spread spectrum etc
6. Capability information. This field defines the capabilities that the client will need to support in
   order to connect with the access point.
7. Traffic Indication Map (TIM). An access point periodically sends the TIM within a beacon to identify
   which stations using power saving mode have data frames waiting for them in the access point’s buffer.
8. Fixed Parameter contains information like if wep is being supported being used and what type of
   modulation is being used.
There are also fields that hold  extra parameters, that has been added to the Wi FI spec since its first
initial standard. This information can be found under tagged parameters.


https://networksystemsblog.wordpress.com/2014/04/21/wi-fi-management-packets-explained-part-1-wi-fi-beacon-frames/
=========================================================================================================
                                 WiFi standarts
=========================================================================================================
                                    802.11ac
=========================================================================================================
                           VHT (Very High Throughput)
---------------------------------------------------------------------------------------------------------
Also known as Very High Throughput (VHT), 802.11ac is positioned as the successor to 802.11n, known as High Throughput (HT)

=========================================================================================================
                                Data Offloading
=========================================================================================================
                                      TODO
=========================================================================================================
                                     Random
=========================================================================================================
https://www.edrawsoft.com/cisco-networks-symbols.php => cisco network diagaram legend

---------------------------------------------------------------------------------------------------------
                               Network simulators
---------------------------------------------------------------------------------------------------------
EVE NG (Emulated Virtual Environment)  http://www.eve-ng.net/
Looks cool but requires separate VM, as result, can be used on any OS
https://www.brianlinkletter.com/how-to-set-up-the-eve-ng-network-emulator-on-a-linux-system/.


http://www.brianlinkletter.com/open-source-network-simulators/

---------------------------------------------------------------------------------------------------------
                                      BSP
---------------------------------------------------------------------------------------------------------
BSP (Board support package) => base code on hardware device containing bootloader to load device drivers
into memory. It perfomrs next taks:
- Initialize the processor, bus, interrupt controller, clock, RAM
- Configure segments if applicable
- Run bootloader

---------------------------------------------------------------------------------------------------------
                        Multiplexing and Demultiplexing
---------------------------------------------------------------------------------------------------------
Multiplexing is the process in which multiple data streams, comming from different sources, are combined
and transmitted over a single data channel or stream. Demultiplexing is process reverse to multiplexing
which routes the separated signals to their corresponding receivers or destinations.

Signal Sources
S3 S2 S1
 |1|4|7|
 |2|5|8|
 |3|6|9|
  1 4 7 2 5 8 3 6 9
==========================>
     Transmission Channel
      9 6 3 8 5 2 7 4 1
    >==========================
                        |1|4|7|
                        |2|5|8|
                        |3|6|9|
                       R3 R2 R1

http://macao.communications.museum/eng/exhibition/secondfloor/moreinfo/2_8_6_Multiplexing.html
=========================================================================================================
                                 Infrastructure 
=========================================================================================================
---------------------------------------------------------------------------------------------------------
                      Networking equipment + segmentation
---------------------------------------------------------------------------------------------------------
Patch pannel => usually building may have hundreds of ethernet slots throught which you can connect your
device to internet, hovewer mayble you don`t use them all or you have device that are in different places
at your home therefore there is patch pannel to which all slots are connected and from there they are
connect to switch. This way you can have hundred slot patch pannel and only 40 slot switch

Demarc => points where authority trasfers from one party to the next Point at which connection from
ISP intersects with your house and ISP is responsible that connection is fine till this box and after
it is yours responsibility.  It is a box that detects quality of signal and you can check wheather it is yours
or ISPs problem Usually you can check it by urself or call ISP and if there is problem from ISP side, they
will fix it otherwise they will bill you for a call of technician. If you are not owning entire building
than you will have one demarc for building managed by building managment and demarc from your floor, building
managment is responsible for their connection

MDF (main distribution facility). Demarc between you and your building managment is MDF, place where network
are interconnect. Probalby place with all patchpannels

IDF (intermidiate distribution facility). Since it can be very tidious or expensive to connect computors on
every floor to one MDF, you will use one IDF per floor which is connected to one MDF

DMZ (DeMilitirezedZone) => way of network architecture ? to protect important data but leave opened not so
important one

    Internet
      |
    Router (most of services open)
      |
    Switch-------------------------- Router (Most of service closed)
      |\\                                          |
      |||\                                         |
    WebServers                          Internal Network
    (Less secure)                   (Really secure, dont want to be hacked)

---------------------------------------------------------------------------------------------------------
                               Connection types ?
---------------------------------------------------------------------------------------------------------
SLA (Service Level Agreements) offer a guarantee of service
DSL (Digital Subscriber Line) depends on distance between client and phone provider
as well as on quality of phone lines. Easy to use for telephone services.

Cable connection
Docsis => depends on count of active users connected to trampline (interconnection of
users and ISP) since connection is splitted there. As well doesnt have service level
agreement therefore you won`t have constant internet speed always

Wireless PPP => requires to set up antena on your house and direct it to antena staying
at ISP (which is turned arround to u). It is not that expensive to open such service provider
therefore if you pay fro service from some really small one, it can take preaty a lot of time
for issue troubleshooting ,etc...

=========================================================================================================
                                      GPON
=========================================================================================================
PON     => Passive Optical Network , is network featuring one-to-multiple-point architecure
GPON    => Gigabit-capable Passive Optical Networks
GE-PON  => Giga-bit Ethernet Passive Optical Networks
APON    => ATM Passive Optical Network
EPON    => Ethernet Passie Optical Network


PSTN     -- /---------\
        |             |         -- -------                --------| ONU |-| Client| 
Internet -- |   OLT   |--------/  \------- More Splitters --------| ONU |-| Client| 
        |             |--------\  /-------                --------| ONU |-| Client| 
CATV     -- \---------/         -- -------                --------| ONU |-| Client| 
        Optical Line         Passive                          Optical Network
         Terminator          Optical                                Unit
                     Spliter
    
What is usage of ONU/ONT 
How ports are working


Optical splitters, passive optical devices that divide a single optical signal into multiple equal but
lower-power signals, distribute the signals to users. An optical network unit (ONU) terminates the PON at
the customer’s home. The ONU usually communicates with an optical network terminal (ONT), which may be 
a separate box that connects the PON to TV sets, telephones, computers, or a wireless router.
The ONU/ONT may be one device.


Downstream from OLT goes in broadcast manner
Upstream TDMA (Time Division Multiple Access) manner.This divides the bandwidth so each user gets a
fraction such as 100 Mbits/s depending upon how the service provider allocates it.

TDM (Time Division Multipleing) where each user is assigned a timeslot on a different wavelength of light
With this arrangement, the splitters act as power combiners.

TODO, rework

=========================================================================================================
                                     Docsis
=========================================================================================================
DOCSIS (Data Over Cable System Interface Specification)
RG (Radio Guide) used to specify Coaxial cables.

CMTS (Cable Modem Termination System) => component that exchanges digital signals with cable modems on a
cable network. It is usually locate at local office of a cable television company. When a CMTS receives
signals from a cable modem, it converts these signals into IP packets which are then sent to an IP router
for transmission across the Internet. Before sending signal to a cable modem, it modulates signal for
receiving cable modem.

CM (Cable Modem).


---------------------------------------------------------------------------------------------------------
                  EMTA (Embedded Multimedia Terminal Adapter)
---------------------------------------------------------------------------------------------------------
Combination of cable modem and telephone adapter.

?Telephone adapter means that it converts digital signals to analog and vice versa, for VOIP?

=========================================================================================================
                         DSL (Digital subscriber line)
=========================================================================================================
Type of service where your data is transmited as sound ? to your phone service provider
You have a dedicated line to your home, not like in another technologies where there is one
line split to many users
Max speed is 12 Mb/s

---------------------------------------------------------------------------------------------------------
               DSLAM (Digital subscriber line access multiplexer)
---------------------------------------------------------------------------------------------------------
Device that aggregates individual subscriber lines into high capacity uplink
Computor =>  Modem => DSLAM => Switch => Router => ISPs
---------------------------------------------------------------------------------------------------------
=========================================================================================================
                                      FTTX
=========================================================================================================
H => Home
P => Premise
B => Building / Buisness
N => Node
C => Curb of cabinet
TODO


=========================================================================================================
                           QOS(trafic prioritization)
=========================================================================================================
Marking  - tagging a packet ,therefore there is no need in deep packet inspection
Policing - creating rules , like max bandwith for some type of trafic
Shaping  - queing outgoing trafic if service is not cappable of receiving
at speed of clint sending
buffering traffic so its flow is results in requested shape, done by shaper
Queing   - whithin queue , some packets will be go in front of less important one
Dropper => tool deciding whether packet will be queued or droped
Congestion Avoidance 
TCP will increase window size on every packet ,therefore, at some moment
u want to drop some random packet (TCP will shrink window) so entire line 
is not filled with TCP

CIR => committed information rate
PIR => peak information rate
Green => input rate < CIR => should assure bandwidth across the network
Yellow => PIR > input rate > CIR => shouldnt assure
Rer => input rate > PIR => should be discarded


=========================================================================================================
                      MPLS (MultiProtocol Label Switching)
=========================================================================================================
Somewhere around 90s there was an idea to avoid inspecting packet to find further routing and instead
somehow tag packet. Cisco came first to this idea and names it TAG Switching. It was aimed to make high
speed routers route packets by hardware. However at that point hardware IP routing wasn`t highly
affordable as well FIB apeared and there was no much use of such mechanism any more.

At some point it became clear that such mechanism doesn`t care about type of protocol behind tag as well
as it is not attached to IP routing. Now this functionality is provided by some bigger ISPs.


# SDN (Software Defined Networking)
=========================================================================================================
                                  Maybe once?
=========================================================================================================
### PPP
LCP (Link Control Protocol) => protocol used by ppp to determine if link is acceptable
and establish session between computer and an ISP.

### Voip

Basic operation =>
- Power over Ethernet (PoE)
- DHCP
- TFTP if implemented
- Signaling protocol
- Transport protocol
- Signaling protocol

Signaling protocol =>
# Hanles registration and calls
- H.323
- SIP
- Skinny

### SIP (Session Initiation Protocol)
# port 5060, tcp

# Components =>
- User agent - initiates or respondes to SIP transactions
  User agent client (UAC) => initiates and accepts responses (phone)
  User agent server (UAS) => accepts requests and sends back responses (call manager)
- Proxy - handles requests on behalf of clients
- Redirect and registrar server (often build in UAC/UAS)

# Addressing =>
- Can use IP but prefers SIP URI
- URI - uniform resource identifier (similar to email)

# Messages
- Register => connects with the call server
- Invite => endpoint attempts to call the other party
- Trying => call server informs source of status
- Ringing => 
- SDP => session description protocol
  Provides parameters for call, specified the media content, codec, ...

#SIP trunk => voice gateway

# Codecs => trasfroms signals from analog to digital and vice-versa
- From caller => analog to digital
- To calle => digital to analog
